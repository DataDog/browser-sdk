const { runMain } = require('../lib/executionUtils')
const { reportAsPrComment } = require('./lib/reportAsAPrComment')
const { reportToDatadog } = require('./lib/reportToDatadog')
const { calculateBundleSizes } = require('./lib/computeBundleSize')
const { computeCpuPerformance } = require('./lib/computeCpuPerformance')
const { computeMemoryPerformance } = require('./lib/computeMemoryPerformance')

runMain(async () => {
  const localBundleSizes = calculateBundleSizes()
  const localMemoryPerformance = await computeMemoryPerformance()
  await computeCpuPerformance()
  await reportToDatadog(localMemoryPerformance, 'memoryPerformance')
  await reportToDatadog(localBundleSizes, 'bundleSizes')
  await reportAsPrComment(localBundleSizes, localMemoryPerformance)
})
