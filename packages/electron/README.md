# Electron SDK (POC)

## Setup

Build SDK locally:

```shell
git clone https://github.com/DataDog/browser-sdk.git
cd browser-sdk
git checkout thomas.lebeau/electron
yarn --mode=skip-build
yarn build
```

Install sdk in project where needed:

- electron

```shell
npm install @datadog/electron@file:<PATH_TO_LOCAL_REPO>/browser-sdk/packages/electron
```

- rum

```shell
npm install @datadog/browser-rum@file:<PATH_TO_LOCAL_REPO>/browser-sdk/packages/rum
```

In your webpack config for the main process, add this extra `externals` configuration:

```
 externals: [
    {
        '@datadog/native-metrics': 'commonjs @datadog/native-metrics',
        '@datadog/native-appsec': 'commonjs @datadog/native-appsec',
        '@datadog/native-iast-taint-tracking': 'commonjs @datadog/native-iast-taint-tracking',
        '@datadog/pprof': 'commonjs @datadog/pprof',
        '@datadog/libdatadog': 'commonjs @datadog/libdatadog',
        '@datadog/openfeature-node-server': 'commonjs @datadog/openfeature-node-server',
        '@opentelemetry/api': 'commonjs @opentelemetry/api',
        '@opentelemetry/api-logs': 'commonjs @opentelemetry/api-logs',
        '@openfeature/core': 'commonjs @openfeature/core',
        '@openfeature/server-sdk': 'commonjs @openfeature/server-sdk'
    },
    function({ request }, callback) {
        if (request && request.startsWith('@datadog/wasm-js-rewriter')) {
            return callback(null, 'commonjs ' + request);
        }
        callback();
    }
]
```

## Main process monitoring

In main:

```javascript
import { ddElectron } from '@datadog/electron/main'

ddElectron.init({
  applicationId: '<APPLICATION_ID>',
  clientToken: '<CLIENT_TOKEN>',
  site: '<SITE>',
  service: '<SERVICE>',
  version: '<VERSION>',
  env: '<ENV>',
})
```

Features:

- Uncaught error collection
- Crash reporting
- Request monitoring

## Link renderer events to main process context

In preload:

```js
import { setupRendererBridge } from '@datadog/electron/preload'

setupRendererBridge()
```

In renderer:

```js
import { datadogRum } from '@datadog/browser-rum'
import { datadogLogs } from '@datadog/browser-logs'

datadogRum.init({
  applicationId: 'xxx',
  clientToken: 'xxx',
  service: '<SERVICE>',
  version: '<VERSION>',
  env: '<ENV>',
})

datadogLogs.init({
  clientToken: 'xxx',
  service: '<SERVICE>',
  version: '<VERSION>',
  env: '<ENV>',
})
```

Features:

- All events generated by rum and logs sdk will have the same application and session than the main process events

## Trace ipc calls

In main:

```js
import { ddElectron, monitorIpcMain } from "@datadog/electron/main";

ddElectron.init({ â€¦ })

const ipcMain = monitorIpcMain()

// use ipcMain instrumented by datadog to listen to events
ipcMain.on(...)
ipcMain.handle(...)
```

In preload:

```js
import { monitorIpcRenderer } from "@datadog/electron/preload";

const ipcRenderer = monitorIpcRenderer()

// use ipcRenderer instrumented by datadog to send events
ipcRenderer.send(...)
ipcRenderer.invoke(...)
```

In renderer:

```js
import { datadogRum } from "@datadog/browser-rum";
import { electronPlugin } from "@datadog/electron/renderer";

datadogRum.init({
  ...,
  plugins: [electronPlugin()]
});
```

Features:

- Generate traces for ipc calls on main and renderer sides
- Generate RUM resource events for ipc calls on renderer side
