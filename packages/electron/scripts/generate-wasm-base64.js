#!/usr/bin/env node

/**
 * This script converts the minidump_bg.wasm file to a base64-encoded string
 * and generates a TypeScript file that exports it.
 * This allows the WASM file to be embedded directly in the built code.
 */

const fs = require('fs')
const path = require('path')

const wasmPath = path.join(__dirname, '../src/wasm/minidump_bg.wasm')
const outputPath = path.join(__dirname, '../src/wasm/minidump_bg.wasm.base64.ts')

console.log('Converting WASM to base64...')
console.log(`  Input: ${wasmPath}`)
console.log(`  Output: ${outputPath}`)

// Read the WASM file
const wasmBuffer = fs.readFileSync(wasmPath)
const base64String = wasmBuffer.toString('base64')

console.log(`  WASM size: ${wasmBuffer.length} bytes`)
console.log(`  Base64 size: ${base64String.length} bytes`)

// Generate the TypeScript file
const tsContent = `// This file is automatically generated by scripts/generate-wasm-base64.js
// Do not edit manually

/**
 * Base64-encoded WebAssembly binary for the minidump parser
 * Original size: ${wasmBuffer.length} bytes
 * Encoded size: ${base64String.length} bytes
 */
export const MINIDUMP_WASM_BASE64 = '${base64String}'
`

fs.writeFileSync(outputPath, tsContent, 'utf-8')
console.log('âœ“ Successfully generated base64 file')
