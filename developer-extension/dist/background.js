(()=>{"use strict";const e={log:"log",debug:"debug",info:"info",warn:"warn",error:"error"},t=console,n={};Object.keys(e).forEach(e=>{n[e]=t[e]});const o="Datadog Browser SDK:",r={debug:n.debug.bind(t,o),log:n.log.bind(t,o),info:n.info.bind(t,o),warn:n.warn.bind(t,o),error:n.error.bind(t,o)},s="https://docs.datadoghq.com",i=`${s}/real_user_monitoring/browser/troubleshooting`,a="More details:";function c(e,t){return(...n)=>{try{return e(...n)}catch(e){r.error(t,e)}}}let u,l=!1;function d(e){l=e}function f(e){return function(){return g(e,this,arguments)}}function g(e,t,n){try{return e.apply(t,n)}catch(e){p(e)}}function p(e){if(m(e),u)try{u(e)}catch(e){m(e)}}function m(...e){l&&r.error("[MONITOR]",...e)}function y(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"_dd_temp_",{get(){return this},configurable:!0});let e=_dd_temp_;return delete Object.prototype._dd_temp_,"object"!=typeof e&&(e="object"==typeof self?self:"object"==typeof window?window:{}),e}const b=y(),h="WorkerGlobalScope"in b;function v(e){var t;const n=null===(t=b.queueMicrotask)||void 0===t?void 0:t.bind(b);"function"==typeof n?n(f(e)):Promise.resolve().then(f(e))}class w{constructor(e){this.onFirstSubscribe=e,this.observers=[]}subscribe(e){return this.addObserver(e),{unsubscribe:()=>this.removeObserver(e)}}notify(e){this.observers.forEach(t=>t(e))}addObserver(e){this.observers.push(e),1===this.observers.length&&this.onFirstSubscribe&&(this.onLastUnsubscribe=this.onFirstSubscribe(this)||void 0)}removeObserver(e){this.observers=this.observers.filter(t=>e!==t),!this.observers.length&&this.onLastUnsubscribe&&this.onLastUnsubscribe()}}function S(...e){return new w(t=>{const n=e.map(e=>e.subscribe(e=>t.notify(e)));return()=>n.forEach(e=>e.unsubscribe())})}class k extends w{constructor(e){super(),this.maxBufferSize=e,this.buffer=[]}notify(e){this.buffer.push(e),this.buffer.length>this.maxBufferSize&&this.buffer.shift(),super.notify(e)}subscribe(e){let t=!1;const n={unsubscribe:()=>{t=!0,this.removeObserver(e)}};return v(()=>{for(const n of this.buffer){if(t)return;e(n)}t||this.addObserver(e)}),n}unbuffer(){v(()=>{this.maxBufferSize=this.buffer.length=0})}}const x={GRANTED:"granted",NOT_GRANTED:"not-granted"};function C(e,t){const n=y();let o;return n.Zone&&"function"==typeof n.Zone.__symbol__&&(o=e[n.Zone.__symbol__(t)]),o||(o=e[t]),o}function _(e,t){return C(y(),"setTimeout")(f(e),t)}function E(e){C(y(),"clearTimeout")(e)}function T(e,t){return C(y(),"setInterval")(f(e),t)}function R(e){C(y(),"clearInterval")(e)}function $(){}const O="?";function A(e){var t,n;const o=[];let r=M(e,"stack");const s=String(e);if(r&&r.startsWith(s)&&(r=r.slice(s.length)),r&&r.split("\n").forEach(e=>{const t=function(e){const t=q.exec(e);if(!t)return;const n=t[2]&&0===t[2].indexOf("native"),o=t[2]&&0===t[2].indexOf("eval"),r=P.exec(t[2]);return o&&r&&(t[2]=r[1],t[3]=r[2],t[4]=r[3]),{args:n?[t[2]]:[],column:t[4]?+t[4]:void 0,func:t[1]||O,line:t[3]?+t[3]:void 0,url:n?void 0:t[2]}}(e)||function(e){const t=D.exec(e);if(t)return{args:[],column:t[3]?+t[3]:void 0,func:O,line:t[2]?+t[2]:void 0,url:t[1]}}(e)||function(e){const t=B.exec(e);if(t)return{args:[],column:t[4]?+t[4]:void 0,func:t[1]||O,line:+t[3],url:t[2]}}(e)||function(e){const t=j.exec(e);if(!t)return;const n=t[3]&&t[3].indexOf(" > eval")>-1,o=N.exec(t[3]);return n&&o&&(t[3]=o[1],t[4]=o[2],t[5]=void 0),{args:t[2]?t[2].split(","):[],column:t[5]?+t[5]:void 0,func:t[1]||O,line:t[4]?+t[4]:void 0,url:t[3]}}(e);t&&(!t.func&&t.line&&(t.func=O),o.push(t))}),o.length>0&&function(){if(void 0!==H)return H;class e extends Error{constructor(){super(),this.name="Error"}}const[t,n]=[e,Error].map(e=>new e);return H=F(Object.getPrototypeOf(t))&&n.stack!==t.stack,H}()&&e instanceof Error){const r=[];let s=e;for(;(s=Object.getPrototypeOf(s))&&F(s);){const e=(null===(t=s.constructor)||void 0===t?void 0:t.name)||O;r.push(e)}for(let e=r.length-1;e>=0&&(null===(n=o[0])||void 0===n?void 0:n.func)===r[e];e--)o.shift()}return{message:M(e,"message"),name:M(e,"name"),stack:o}}const I="((?:file|https?|blob|chrome-extension|electron|native|eval|webpack|snippet|<anonymous>|\\w+\\.|\\/).*?)",L="(?::(\\d+))",q=new RegExp(`^\\s*at (.*?) ?\\(${I}${L}?${L}?\\)?\\s*$`,"i"),P=new RegExp(`\\((\\S*)${L}${L}\\)`),D=new RegExp(`^\\s*at ?${I}${L}?${L}??\\s*$`,"i"),B=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,j=/^\s*(.*?)(?:\((.*?)\))?(?:(?:(?:^|@)((?:file|https?|blob|chrome|webpack|resource|capacitor|\[native).*?|[^@]*bundle|\[wasm code\])(?::(\d+))?(?::(\d+))?)|@)\s*$/i,N=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function M(e,t){if("object"!=typeof e||!e||!(t in e))return;const n=e[t];return"string"==typeof n?n:void 0}const U=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?([\s\S]*)$/;function F(e){return String(e.constructor).startsWith("class ")}let H;function z(e){const t=new Error(e);let n;return t.name="HandlingStack",g(()=>{const e=A(t);e.stack=e.stack.slice(2),n=G(e)}),n}function G(e){let t=W(e);return e.stack.forEach(e=>{const n="?"===e.func?"<anonymous>":e.func,o=e.args&&e.args.length>0?`(${e.args.join(", ")})`:"",r=e.line?`:${e.line}`:"",s=e.line&&e.column?`:${e.column}`:"";t+=`\n  at ${n}${o} @ ${e.url}${r}${s}`}),t}function W(e){return`${e.name||"Error"}: ${e.message}`}function V(e,t,n,{computeHandlingStack:o}={}){let r=e[t];if("function"!=typeof r){if(!(t in e)||!t.startsWith("on"))return{stop:$};r=$}let s=!1;const i=function(){if(s)return r.apply(this,arguments);const e=Array.from(arguments);let t;g(n,null,[{target:this,parameters:e,onPostCall:e=>{t=e},handlingStack:o?z("instrumented method"):void 0}]);const i=r.apply(this,e);return t&&g(t,null,[i]),i};return e[t]=i,{stop:()=>{s=!0,e[t]===i&&(e[t]=r)}}}const J=1e3,K=6e4;function Z(){return(new Date).getTime()}function X(){return Z()}function Y(){return performance.now()}function Q(){return{relative:Y(),timeStamp:X()}}function ee(e,t){return t-e}let te;function ne(){var e,t;return void 0===te&&(te=null!==(t=null===(e=performance.timing)||void 0===e?void 0:e.navigationStart)&&void 0!==t?t:performance.timeOrigin),te}const oe=/[^\u0000-\u007F]/;function re(e){return oe.test(e)?void 0!==window.TextEncoder?(new TextEncoder).encode(e).length:new Blob([e]).size:e.length}function se(e,t,n){if("object"!=typeof e||null===e)return JSON.stringify(e);const o=ie(Object.prototype),r=ie(Array.prototype),s=ie(Object.getPrototypeOf(e)),i=ie(e);try{return JSON.stringify(e,t,n)}catch(e){return"<error: unable to serialize object>"}finally{o(),r(),s(),i()}}function ie(e){const t=e,n=t.toJSON;return n?(delete t.toJSON,()=>{t.toJSON=n}):$}function ae(e,t=225280){const n=ie(Object.prototype),o=ie(Array.prototype),r=[],s=new WeakMap,i=ce(e,"$",void 0,r,s),a=JSON.stringify(i);let c=a?a.length:0;if(!(c>t)){for(;r.length>0&&c<t;){const n=r.shift();let o=0;if(Array.isArray(n.source))for(let i=0;i<n.source.length;i++){const a=ce(n.source[i],n.path,i,r,s);if(c+=void 0!==a?JSON.stringify(a).length:4,c+=o,o=1,c>t){le(t,"truncated",e);break}n.target[i]=a}else for(const i in n.source)if(Object.prototype.hasOwnProperty.call(n.source,i)){const a=ce(n.source[i],n.path,i,r,s);if(void 0!==a&&(c+=JSON.stringify(a).length+o+i.length+3,o=1),c>t){le(t,"truncated",e);break}n.target[i]=a}}return n(),o(),i}le(t,"discarded",e)}function ce(e,t,n,o,r){const s=function(e){const t=e;if(t&&"function"==typeof t.toJSON)try{return t.toJSON()}catch(e){}return e}(e);if(!s||"object"!=typeof s)return"bigint"==typeof(i=s)?`[BigInt] ${i.toString()}`:"function"==typeof i?`[Function] ${i.name||"unknown"}`:"symbol"==typeof i?`[Symbol] ${i.description||i.toString()}`:i;var i;const a=ue(s);if("[Object]"!==a&&"[Array]"!==a&&"[Error]"!==a)return a;const c=e;if(r.has(c))return`[Reference seen at ${r.get(c)}]`;const u=void 0!==n?`${t}.${n}`:t,l=Array.isArray(s)?[]:{};return r.set(c,u),o.push({source:s,target:l,path:u}),l}function ue(e){try{if(e instanceof Event)return{type:(t=e).type,isTrusted:t.isTrusted,currentTarget:t.currentTarget?ue(t.currentTarget):null,target:t.target?ue(t.target):null};if(e instanceof RegExp)return`[RegExp] ${e.toString()}`;const n=Object.prototype.toString.call(e).match(/\[object (.*)\]/);if(n&&n[1])return`[${n[1]}]`}catch(e){}var t;return"[Unserializable]"}function le(e,t,n){r.warn(`The data provided has been ${t} as it is over the limit of ${e} characters:`,n)}const de="No stack, consider using an instance of Error";function fe({stackTrace:e,originalError:t,handlingStack:n,componentStack:o,startClocks:r,nonErrorPrefix:s,useFallbackStack:i=!0,source:a,handling:c}){const u=ye(t);return!e&&u&&(e=A(t)),{startClocks:r,source:a,handling:c,handlingStack:n,componentStack:o,originalError:t,type:e?e.name:void 0,message:ge(e,u,s,t),stack:e?G(e):i?de:void 0,causes:u?be(t,a):void 0,fingerprint:pe(t),context:me(t)}}function ge(e,t,n,o){return(null==e?void 0:e.message)&&(null==e?void 0:e.name)?e.message:t?"Empty message":`${n} ${se(ae(o))}`}function pe(e){return ye(e)&&"dd_fingerprint"in e?String(e.dd_fingerprint):void 0}function me(e){if(null!==e&&"object"==typeof e&&"dd_context"in e)return e.dd_context}function ye(e){return e instanceof Error||"[object Error]"===Object.prototype.toString.call(e)}function be(e,t){let n=e;const o=[];for(;ye(null==n?void 0:n.cause)&&o.length<10;){const e=A(n.cause);o.push({message:n.cause.message,source:t,type:null==e?void 0:e.name,stack:e&&G(e)}),n=n.cause}return o.length?o:void 0}const he="agent",ve="console",we="logger",Se="source",ke="report";function xe(){return new w(e=>{const t=(t,n)=>{const o=fe({stackTrace:n,originalError:t,startClocks:Q(),nonErrorPrefix:"Uncaught",source:Se,handling:"unhandled"});e.notify(o)},{stop:n}=(o=t,V(y(),"onerror",({parameters:[e,t,n,r,s]})=>{let i;ye(s)||(i=function(e,t,n,o){if(void 0===t)return;const{name:r,message:s}=function(e){let t,n;return"[object String]"==={}.toString.call(e)&&([,t,n]=U.exec(e)),{name:t,message:n}}(e);return{name:r,message:s,stack:[{url:t,column:o,line:n}]}}(e,t,n,r)),o(null!=s?s:e,i)}));var o;const{stop:r}=function(e){return V(y(),"onunhandledrejection",({parameters:[t]})=>{e(t.reason||"Empty reason")})}(t);return()=>{n(),r()}})}function Ce(e,t){return Object.keys(e).some(n=>e[n]===t)}function _e(e){return 0===Object.keys(e).length}var Ee;!function(e){e.TRACK_INTAKE_REQUESTS="track_intake_requests",e.USE_TREE_WALKER_FOR_ACTION_NAME="use_tree_walker_for_action_name",e.FEATURE_OPERATION_VITAL="feature_operation_vital",e.SHORT_SESSION_INVESTIGATION="short_session_investigation",e.AVOID_FETCH_KEEPALIVE="avoid_fetch_keepalive"}(Ee||(Ee={}));const Te=new Set;function Re(e){return Te.has(e)}function $e(){return Te}function Oe(e){const{env:t,service:n,version:o,datacenter:r,sdkVersion:s,variant:i}=e,a=[Ae("sdk_version",null!=s?s:"dev")];return t&&a.push(Ae("env",t)),n&&a.push(Ae("service",n)),o&&a.push(Ae("version",o)),r&&a.push(Ae("datacenter",r)),i&&a.push(Ae("variant",i)),a}function Ae(e,t){const n=t?`${e}:${t}`:e;return(n.length>200||function(e){return!!function(){try{return new RegExp("[\\p{Ll}]","u"),!0}catch(e){return!1}}()&&new RegExp("[^\\p{Ll}\\p{Lo}0-9_:./-]","u").test(e)}(n))&&r.warn(`Tag ${n} doesn't meet tag requirements and will be sanitized. ${a} ${s}/getting_started/tagging/#defining-tags`),Ie(n)}function Ie(e){return e.replace(/,/g,"_")}const Le="datadoghq.com",qe=["ddsource","dd-api-key","dd-request-id"];function Pe(e,t){const n=b.__ddBrowserSdkExtensionCallback;n&&n({type:e,payload:t})}function De(e){return 0!==e&&100*Math.random()<=e}function Be(e){return null===e?"null":Array.isArray(e)?"array":typeof e}function je(e,t,n=function(){if("undefined"!=typeof WeakSet){const e=new WeakSet;return{hasAlreadyBeenSeen(t){const n=e.has(t);return n||e.add(t),n}}}const e=[];return{hasAlreadyBeenSeen(t){const n=e.indexOf(t)>=0;return n||e.push(t),n}}}()){if(void 0===t)return e;if("object"!=typeof t||null===t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const e=t.flags||[t.global?"g":"",t.ignoreCase?"i":"",t.multiline?"m":"",t.sticky?"y":"",t.unicode?"u":""].join("");return new RegExp(t.source,e)}if(n.hasAlreadyBeenSeen(t))return;if(Array.isArray(t)){const o=Array.isArray(e)?e:[];for(let e=0;e<t.length;++e)o[e]=je(o[e],t[e],n);return o}const o="object"===Be(e)?e:{};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=je(o[e],t[e],n));return o}function Ne(e){return je(void 0,e)}function Me(...e){let t;for(const n of e)null!=n&&(t=je(t,n));return t}function Ue(){var e;const t=b.navigator;return{status:t.onLine?"connected":"not_connected",interfaces:t.connection&&t.connection.type?[t.connection.type]:void 0,effective_type:null===(e=t.connection)||void 0===e?void 0:e.effectiveType}}function Fe(){const e=y().DatadogEventBridge;if(e)return{getCapabilities(){var t;return JSON.parse((null===(t=e.getCapabilities)||void 0===t?void 0:t.call(e))||"[]")},getPrivacyLevel(){var t;return null===(t=e.getPrivacyLevel)||void 0===t?void 0:t.call(e)},getAllowedWebViewHosts:()=>JSON.parse(e.getAllowedWebViewHosts()),send(t,n,o){const r=o?{id:o}:void 0;e.send(JSON.stringify({eventType:t,event:n,view:r}))}}}function He(e){var t;void 0===e&&(e=null===(t=y().location)||void 0===t?void 0:t.hostname);const n=Fe();return!!n&&n.getAllowedWebViewHosts().some(t=>e===t||e.endsWith(`.${t}`))}function ze(e){return Object.values(e)}function Ge(e,t,n,o,r){return We(e,t,[n],o,r)}function We(e,t,n,o,{once:r,capture:s,passive:i}={}){const a=f(t=>{(t.isTrusted||t.__ddIsTrusted||e.allowUntrustedEvents)&&(r&&d(),o(t))}),c=i?{capture:s,passive:i}:s,u=window.EventTarget&&t instanceof EventTarget?window.EventTarget.prototype:t,l=C(u,"addEventListener");function d(){const e=C(u,"removeEventListener");n.forEach(n=>e.call(t,n,a,c))}return n.forEach(e=>l.call(t,e,a,c)),{stop:d}}const Ve={HIDDEN:"visibility_hidden",UNLOADING:"before_unload",PAGEHIDE:"page_hide",FROZEN:"page_frozen"};function Je({encoder:e,request:t,flushController:n}){let o={};const s=n.flushObservable.subscribe(n=>function(n){const r=ze(o).join("\n");o={};const s=(a=n.reason,ze(Ve).includes(a)),i=s?t.sendOnExit:t.send;var a;if(s&&e.isAsync){const t=e.finishSync();t.outputBytesCount&&i(Ke(t));const n=[t.pendingData,r].filter(Boolean).join("\n");n&&i({data:n,bytesCount:re(n)})}else r&&e.write(e.isEmpty?r:`\n${r}`),e.finish(e=>{i(Ke(e))})}(n));function c(t,s){const c=se(t),u=e.estimateEncodedBytesCount(c);u>=262144?r.warn(`Discarded a message whose size was bigger than the maximum allowed size 256KiB. ${a} ${i}/#technical-limitations`):(function(e){return void 0!==e&&void 0!==o[e]}(s)&&function(t){const r=o[t];delete o[t];const s=e.estimateEncodedBytesCount(r);n.notifyAfterRemoveMessage(s)}(s),function(t,r,s){n.notifyBeforeAddMessage(r),void 0!==s?(o[s]=t,n.notifyAfterAddMessage()):e.write(e.isEmpty?t:`\n${t}`,e=>{n.notifyAfterAddMessage(e-r)})}(c,u,s))}return{flushController:n,add:c,upsert:c,stop:s.unsubscribe}}function Ke(e){let t;return t="string"==typeof e.output?e.output:new Blob([e.output],{type:"text/plain"}),{data:t,bytesCount:e.outputBytesCount,encoding:e.encoding}}function Ze(e){return e>=500}const Xe=J;function Ye(e,t,n,o,r,s){0===t.transportStatus&&0===t.queuedPayloads.size()&&t.bandwidthMonitor.canHandle(e)?et(e,t,n,s,{onSuccess:()=>tt(0,t,n,o,r,s),onFailure:()=>{t.queuedPayloads.enqueue(e)||s.notify({type:"queue-full",bandwidth:t.bandwidthMonitor.stats(),payload:e}),Qe(t,n,o,r,s)}}):t.queuedPayloads.enqueue(e)||s.notify({type:"queue-full",bandwidth:t.bandwidthMonitor.stats(),payload:e})}function Qe(e,t,n,o,r){2===e.transportStatus&&_(()=>{et(e.queuedPayloads.first(),e,t,r,{onSuccess:()=>{e.queuedPayloads.dequeue(),e.currentBackoffTime=Xe,tt(1,e,t,n,o,r)},onFailure:()=>{e.currentBackoffTime=Math.min(6e4,2*e.currentBackoffTime),Qe(e,t,n,o,r)}})},e.currentBackoffTime)}function et(e,t,n,o,{onSuccess:r,onFailure:s}){t.bandwidthMonitor.add(e),n(e,n=>{t.bandwidthMonitor.remove(e),function(e){return"opaque"!==e.type&&(0===e.status&&!navigator.onLine||408===e.status||429===e.status||Ze(e.status))}(n)?(t.transportStatus=t.bandwidthMonitor.ongoingRequestCount>0?1:2,e.retry={count:e.retry?e.retry.count+1:1,lastFailureStatus:n.status},o.notify({type:"failure",bandwidth:t.bandwidthMonitor.stats(),payload:e}),s()):(t.transportStatus=0,o.notify({type:"success",bandwidth:t.bandwidthMonitor.stats(),payload:e}),r())})}function tt(e,t,n,o,r,s){0===e&&t.queuedPayloads.isFull()&&!t.queueFullReported&&(r({message:`Reached max ${o} events size queued for upload: 20MiB`,source:he,startClocks:Q()}),t.queueFullReported=!0);const i=t.queuedPayloads;for(t.queuedPayloads=nt();i.size()>0;)Ye(i.dequeue(),t,n,o,r,s)}function nt(){const e=[];return{bytesCount:0,enqueue(t){return!this.isFull()&&(e.push(t),this.bytesCount+=t.bytesCount,!0)},first:()=>e[0],dequeue(){const t=e.shift();return t&&(this.bytesCount-=t.bytesCount),t},size:()=>e.length,isFull(){return this.bytesCount>=20971520}}}function ot(e,t,n=16384){const o=new w,r={transportStatus:0,currentBackoffTime:Xe,bandwidthMonitor:{ongoingRequestCount:0,ongoingByteCount:0,canHandle(e){return 0===this.ongoingRequestCount||this.ongoingByteCount+e.bytesCount<=81920&&this.ongoingRequestCount<32},add(e){this.ongoingRequestCount+=1,this.ongoingByteCount+=e.bytesCount},remove(e){this.ongoingRequestCount-=1,this.ongoingByteCount-=e.bytesCount},stats(){return{ongoingByteCount:this.ongoingByteCount,ongoingRequestCount:this.ongoingRequestCount}}},queuedPayloads:nt(),queueFullReported:!1};return{observable:o,send:s=>{for(const i of e)Ye(s,r,(e,t)=>{Re(Ee.AVOID_FETCH_KEEPALIVE)?at(i,e,t):it(i,n,e,t)},i.trackType,t,o)},sendOnExit:t=>{for(const o of e)rt(o,n,t)}}}function rt(e,t,n){if(navigator.sendBeacon&&n.bytesCount<t)try{const t=e.build("beacon",n);if(navigator.sendBeacon(t,n.data))return}catch(e){!function(e){st||(st=!0,p(e))}(e)}at(e,n)}let st=!1;function it(e,t,n,o){if(function(){try{return window.Request&&"keepalive"in new Request("http://a")}catch(e){return!1}}()&&n.bytesCount<t){const t=e.build("fetch-keepalive",n);fetch(t,{method:"POST",body:n.data,keepalive:!0,mode:"cors"}).then(f(e=>null==o?void 0:o({status:e.status,type:e.type}))).catch(f(()=>at(e,n,o)))}else at(e,n,o)}function at(e,t,n){const o=e.build("fetch",t);fetch(o,{method:"POST",body:t.data,mode:"cors"}).then(f(e=>null==n?void 0:n({status:e.status,type:e.type}))).catch(f(()=>null==n?void 0:n({status:0})))}const ct=h?1:50;function ut({pageMayExitObservable:e,sessionExpireObservable:t}){const n=e.subscribe(e=>c(e.reason)),o=t.subscribe(()=>c("session_expire")),r=new w(()=>()=>{n.unsubscribe(),o.unsubscribe()});let s,i=0,a=0;function c(e){if(0===a)return;const t=a,n=i;a=0,i=0,u(),r.notify({reason:e,messagesCount:t,bytesCount:n})}function u(){E(s),s=void 0}return{flushObservable:r,get messagesCount(){return a},notifyBeforeAddMessage(e){i+e>=16384&&c("bytes_limit"),a+=1,i+=e,void 0===s&&(s=_(()=>{c("duration_limit")},3e4))},notifyAfterAddMessage(e=0){i+=e,a>=ct?c("messages_limit"):i>=16384&&c("bytes_limit")},notifyAfterRemoveMessage(e){i-=e,a-=1,0===a&&u()}}}const lt="DISCARDED",dt="SKIPPED",ft="log",gt="configuration",pt="usage",mt=["https://www.datadoghq-browser-agent.com","https://www.datad0g-browser-agent.com","https://d3uc069fcn7uxw.cloudfront.net","https://d20xtzwzcl0ceb.cloudfront.net","http://localhost","<anonymous>"],yt=["ddog-gov.com"];let bt;function ht(){return bt||(bt=new k(100)),bt}function vt(e,t,n,o,r,s){const i=new w,{stop:a}=function(e,t,n,o,r){const s=[];if(He()){const e=Fe(),t=r.subscribe(t=>e.send("internal_telemetry",t));s.push(t.unsubscribe)}else{const i=[e.rumEndpointBuilder];e.replica&&function(e){return"datad0g.com"===e.site}(e)&&i.push(e.replica.rumEndpointBuilder);const a=Je({encoder:o(4),request:ot(i,t),flushController:ut({pageMayExitObservable:n,sessionExpireObservable:new w})});s.push(a.stop);const c=r.subscribe(a.add);s.push(c.unsubscribe)}return{stop:()=>s.forEach(e=>e())}}(t,o,r,s,i),{enabled:c,metricsEnabled:l}=function(e,t,n,o,r=1,s=15){const i={},a=!yt.includes(t.site)&&De(t.telemetrySampleRate),c={[ft]:a,[gt]:a&&De(t.telemetryConfigurationSampleRate),[pt]:a&&De(t.telemetryUsageSampleRate),metric:a&&De(r)},l={is_local_file:"file:"===(null===(f=b.location)||void 0===f?void 0:f.protocol),is_worker:h},d=ht();var f;return d.subscribe(({rawEvent:r,metricName:a})=>{if(a&&!c.metric||!c[r.type])return;const u=a||r.status||r.type;let d=i[u];if(d||(d=i[u]=new Set),d.size>=s)return;const f=se(r);if(d.has(f))return;const g=n.triggerHook(1,{startTime:Q().relative});if(g===lt)return;const p=function(e,n,o,r){const s={type:"telemetry",date:Q().timeStamp,service:n,version:"dev",source:"browser",_dd:{format_version:2},telemetry:Me(o,{runtime_env:r,connectivity:Ue(),sdk_setup:"npm"}),ddtags:Oe(t).join(","),experimental_features:Array.from($e())};return Me(s,e)}(g,e,r,l);o.notify(p),Pe("telemetry",p),d.add(f)}),d.unbuffer(),u=St,{enabled:a,metricsEnabled:c.metric}}(e,t,n,i);return{stop:a,enabled:c,metricsEnabled:l}}function wt(t,n){m(e.debug,t,n),ht().notify({rawEvent:{type:ft,message:t,status:"debug",...n}})}function St(e,t){ht().notify({rawEvent:{type:ft,status:"error",...xt(e),...t}})}function kt(e){ht().notify({rawEvent:{type:pt,usage:e}})}function xt(e){if(ye(e)){const t=A(e);return{error:{kind:t.name,stack:G(Ct(t))},message:t.message}}return{error:{stack:de},message:`Uncaught ${se(e)}`}}function Ct(e){return e.stack=e.stack.filter(e=>!e.url||mt.some(t=>e.url.startsWith(t))),e}function _t(e,t,n,o){return f((...r)=>(o&&kt({feature:o}),e()[t][n](...r)))}function Et(e,t,n){e.changeObservable.subscribe(()=>{const o=e.getContext();n.add(e=>e[t].setContext(o))})}const Tt="userContext",Rt="globalContext",$t="accountContext",Ot="getContext",At="setContext",It="setContextProperty",Lt="removeContextProperty",qt="clearContext";function Pt(e,t){t.silentMultipleInit||r.error(`${e} is already initialized.`)}function Dt(e,t,n){const o={...e};for(const[e,{required:s,type:i}]of Object.entries(t))"string"!==i||Bt(o[e])||(o[e]=String(o[e])),s&&Bt(o[e])&&r.warn(`The property ${e} of ${n} is required; context will not be sent to the intake.`);return o}function Bt(e){return null==e||""===e}function jt(e="",{propertiesConfig:t={}}={}){let n={};const o=new w,s={getContext:()=>Ne(n),setContext:i=>{!function(e){const t="object"===Be(e);return t||r.error("Unsupported context:",e),t}(i)?s.clearContext():n=ae(Dt(i,t,e)),o.notify()},setContextProperty:(r,s)=>{n=ae(Dt({...n,[r]:s},t,e)),o.notify()},removeContextProperty:r=>{delete n[r],Dt(n,t,e),o.notify()},clearContext:()=>{n={},o.notify()},changeObservable:o};return s}function Nt(e,t,n){const o=n.getHandler(),r=Array.isArray(o)?o:[o];return Ut[e]>=Ut[n.getLevel()]&&r.includes(t)}const Mt={ok:"ok",debug:"debug",info:"info",notice:"notice",warn:"warn",error:"error",critical:"critical",alert:"alert",emerg:"emerg"},Ut={[Mt.ok]:0,[Mt.debug]:1,[Mt.info]:2,[Mt.notice]:4,[Mt.warn]:5,[Mt.error]:6,[Mt.critical]:7,[Mt.alert]:8,[Mt.emerg]:9};function Ft(e,{includeMessage:t=!1}={}){return{stack:e.stack,kind:e.type,message:t?e.message:void 0,causes:e.causes,fingerprint:e.fingerprint,handling:e.handling}}const Ht="http",zt=Object.keys(Mt);class Gt{constructor(e,t,n=Ht,o=Mt.debug,r={}){this.handleLogStrategy=e,this.handlerType=n,this.level=o,this.contextManager=jt("logger"),this.tags=[],this.contextManager.setContext(r),t&&this.contextManager.setContextProperty("logger",{name:t})}logImplementation(e,t,n=Mt.info,o,r){const s=ae(t);let i;if(null!=o){const e=fe({originalError:o,nonErrorPrefix:"Provided",source:we,handling:"handled",startClocks:Q()});i=Me({error:Ft(e,{includeMessage:!0})},e.context,s)}else i=s;this.handleLogStrategy({message:ae(e),context:i,status:n},this,r)}log(e,t,n=Mt.info,o){let r;Nt(n,Ht,this)&&(r=z("log")),this.logImplementation(e,t,n,o,r)}setContext(e){this.contextManager.setContext(e)}getContext(){return this.contextManager.getContext()}setContextProperty(e,t){this.contextManager.setContextProperty(e,t)}removeContextProperty(e){this.contextManager.removeContextProperty(e)}clearContext(){this.contextManager.clearContext()}addTag(e,t){this.tags.push(Ae(e,t))}removeTagsWithKey(e){const t=Ie(e);this.tags=this.tags.filter(e=>e!==t&&!e.startsWith(`${t}:`))}getTags(){return this.tags.slice()}setHandler(e){this.handlerType=e}getHandler(){return this.handlerType}setLevel(e){this.level=e}getLevel(){return this.level}}function Wt(e){return function(t,n,o){let r;Nt(e,Ht,this)&&(r=z("log")),this.logImplementation(t,n,e,o,r)}}function Vt(){return h?{}:{view:{referrer:document.referrer,url:window.location.href}}}function Jt(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}(function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);s>3&&i&&Object.defineProperty(t,n,i)})([function(e,t,n){const o=n.value;n.value=function(...e){return(u?f(o):o).apply(this,e)}}],Gt.prototype,"logImplementation",null),Gt.prototype.ok=Wt(Mt.ok),Gt.prototype.debug=Wt(Mt.debug),Gt.prototype.info=Wt(Mt.info),Gt.prototype.notice=Wt(Mt.notice),Gt.prototype.warn=Wt(Mt.warn),Gt.prototype.error=Wt(Mt.error),Gt.prototype.critical=Wt(Mt.critical),Gt.prototype.alert=Wt(Mt.alert),Gt.prototype.emerg=Wt(Mt.emerg);const Kt=[];function Zt(e,t,n,o){const r=function(e,t){return`_dd_c_${e}_${t}`}(n,o);Kt.push(Ge(e,window,"storage",({key:e})=>{r===e&&t.setContext(i())})),t.changeObservable.subscribe(function(){localStorage.setItem(r,JSON.stringify(t.getContext()))});const s=Me(i(),t.getContext());function i(){const e=localStorage.getItem(r);return e?JSON.parse(e):{}}_e(s)||t.setContext(s)}function Xt(){return jt("global context")}function Yt(){return jt("account",{propertiesConfig:{id:{type:"string",required:!0},name:{type:"string"}}})}function Qt(){return jt("user",{propertiesConfig:{id:{type:"string"},name:{type:"string"},email:{type:"string"}}})}function en(e){return tn(e,location.href).href}function tn(e,t){const{URL:n}=function(){if(!nn){let e,t;try{e=document.createElement("iframe"),e.style.display="none",document.body.appendChild(e),t=e.contentWindow}catch(e){t=b}nn={URL:t.URL},null==e||e.remove()}return nn}();try{return void 0!==t?new n(e,t):new n(e)}catch(e){throw new Error(`Failed to construct URL: ${String(e)}`)}}let nn,on;const rn=[];function sn({responseBodyAction:e}={}){return e&&rn.push(e),on||(on=new w(e=>{if(!b.fetch)return;const{stop:t}=V(b,"fetch",t=>function({parameters:e,onPostCall:t,handlingStack:n},o){const[r,s]=e;let i=s&&s.method;void 0===i&&r instanceof Request&&(i=r.method);const a=void 0!==i?String(i).toUpperCase():"GET",c=r instanceof Request?r.url:en(String(r)),u={state:"start",init:s,input:r,method:a,startClocks:Q(),url:c,handlingStack:n};o.notify(u),e[0]=u.input,e[1]=u.init,t(e=>{(async function(e,t,n){var o,r;const s=n;let i;s.state="resolve";try{i=await t}catch(t){return s.status=0,s.isAborted=(null===(r=null===(o=s.init)||void 0===o?void 0:o.signal)||void 0===r?void 0:r.aborted)||t instanceof DOMException&&t.code===DOMException.ABORT_ERR,s.error=t,void e.notify(s)}s.response=i,s.status=i.status,s.responseType=i.type,s.isAborted=!1;const a=rn.reduce((e,t)=>Math.max(e,t(s)),0);if(0!==a){const e=function(e){try{return e.clone()}catch(e){return}}(i);if(e&&e.body)try{const t=await async function(e,t){const n=e.getReader(),o=[];for(;;){const e=await n.read();if(e.done)break;t.collectStreamBody&&o.push(e.value)}return n.cancel().catch($),t.collectStreamBody?function(e){if(1===e.length)return e[0];const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);let o=0;for(const t of e)n.set(t,o),o+=t.length;return n}(o):void 0}(e.body,{collectStreamBody:2===a});s.responseBody=t&&(new TextDecoder).decode(t)}catch(e){}}e.notify(s)})(o,e,u).catch(p)})}(t,e),{computeHandlingStack:!0});return t})),on}function an(e){return e?(parseInt(e,10)^16*Math.random()>>parseInt(e,10)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,an)}const cn=/([\w-]+)\s*=\s*([^;]+)/g;function un(e,t,n=""){const o=e.charCodeAt(t-1),r=o>=55296&&o<=56319?t+1:t;return e.length<=r?e:`${e.slice(0,r)}${n}`}let ln,dn,fn;function gn(e,t,n=0,o){const r=new Date;r.setTime(r.getTime()+n);const s=`expires=${r.toUTCString()}`,i=o&&o.crossSite?"none":"strict",a=o&&o.domain?`;domain=${o.domain}`:"",c=o&&o.secure?";secure":"",u=o&&o.partitioned?";partitioned":"";document.cookie=`${e}=${t};${s};path=/;samesite=${i}${a}${c}${u}`}function pn(e){return function(e,t){for(cn.lastIndex=0;;){const n=cn.exec(e);if(!n)break;if(n[1]===t)return n[2]}}(document.cookie,e)}function mn(e){return dn||(dn=function(e){const t=new Map;for(cn.lastIndex=0;;){const n=cn.exec(e);if(!n)break;t.set(n[1],n[2])}return t}(document.cookie)),dn.get(e)}function yn(e,t){gn(e,"",0,t)}function bn(e=location.hostname,t=document.referrer){if(void 0===fn){const n=function(e,t){try{return e||tn(t).hostname}catch(e){}}(e,t);if(n){const e=`dd_site_test_${an()}`,t="test",o=n.split(".");let r=o.pop();for(;o.length&&!pn(e);)r=`${o.pop()}.${r}`,gn(e,t,J,{domain:r});yn(e,{domain:r}),fn=r}}return fn}const hn="_dd_s",vn=144e5,wn=9e5,Sn="cookie",kn="local-storage",xn=/^([a-zA-Z]+)=([a-z0-9-]+)$/;function Cn(e,t){const n={isExpired:"1"};return t.trackAnonymousUser&&(null==e?void 0:e.anonymousId)&&(n.anonymousId=null==e?void 0:e.anonymousId),n}function _n(e){return _e(e)}function En(e){return!_n(e)}function Tn(e){return void 0!==e.isExpired||!((void 0===(t=e).created||Z()-Number(t.created)<vn)&&(void 0===t.expire||Z()<Number(t.expire)));var t}function Rn(e){e.expire=String(Z()+wn)}function $n(e){return(t=e,Object.entries(t)).map(([e,t])=>"anonymousId"===e?`aid=${t}`:`${e}=${t}`).join("&");var t}function On(e){const t={};return function(e){return!!e&&(-1!==e.indexOf("&")||xn.test(e))}(e)&&e.split("&").forEach(e=>{const n=xn.exec(e);if(null!==n){const[,e,o]=n;"aid"===e?t.anonymousId=o:t[e]=o}}),t}function An(e){const t=function(e){const t={};if(t.secure=!!e.useSecureSessionCookie||!!e.usePartitionedCrossSiteSessionCookie,t.crossSite=!!e.usePartitionedCrossSiteSessionCookie,t.partitioned=!!e.usePartitionedCrossSiteSessionCookie,e.trackSessionAcrossSubdomains){const e=bn();if(!e)return;t.domain=e}return t}(e);return t&&function(e){if(void 0===document.cookie||null===document.cookie)return!1;try{const t=`dd_cookie_test_${an()}`,n="test";gn(t,n,K,e);const o=pn(t)===n;return yn(t,e),o}catch(e){return r.error(e),!1}}(t)?{type:Sn,cookieOptions:t}:void 0}function In(e,t,n,o){let r=$n(n);t.betaEncodeCookieOptions&&(r=$n({...n,..._e(n)?{}:{c:qn(e)}})),gn(hn,r,t.trackAnonymousUser?31536e6:o,e)}function Ln(e,t){return t.betaEncodeCookieOptions?function(e){const t=(o=hn,function(e){const t=new Map;for(cn.lastIndex=0;;){const n=cn.exec(e);if(!n)break;{const e=n[1],o=n[2];t.has(e)?t.get(e).push(o):t.set(e,[o])}}return t}(document.cookie).get(o)||[]),n=qn(e);var o;let r;for(const e of t.reverse())if(r=On(e),r.c===n)break;return null==r||delete r.c,null!=r?r:{}}(e):On(pn(hn))}function qn(e){let t=0;return t|=0,t|=(e.domain?e.domain.split(".").length-1:0)<<1,t|=e.crossSite?1:0,t.toString(16)}function Pn(){try{const e=an(),t=`_dd_test_${e}`;localStorage.setItem(t,e);const n=localStorage.getItem(t);return localStorage.removeItem(t),e===n?{type:kn}:void 0}catch(e){return}}function Dn(e){localStorage.setItem(hn,$n(e))}function Bn(){return On(localStorage.getItem(hn))}const jn=[];let Nn;function Mn(e,t,n=0){var o;const{isLockEnabled:r,persistSession:s,expireSession:i}=t,a=e=>s({...e,lock:u}),c=()=>{const{lock:e,...n}=t.retrieveSession();return{session:n,lock:e&&!Hn(e)?e:void 0}};if(Nn||(Nn=e),e!==Nn)return void jn.push(e);if(r&&n>=100)return void Fn(t);let u,l=c();if(r){if(l.lock)return void Un(e,t,n);if(u=an()+"--"+X(),a(l.session),l=c(),l.lock!==u)return void Un(e,t,n)}let d=e.process(l.session);if(r&&(l=c(),l.lock!==u))Un(e,t,n);else{if(d&&(Tn(d)?i(d):(Rn(d),r?a(d):s(d))),r&&(!d||!Tn(d))){if(l=c(),l.lock!==u)return void Un(e,t,n);s(l.session),d=l.session}null===(o=e.after)||void 0===o||o.call(e,d||l.session),Fn(t)}}function Un(e,t,n){_(()=>{Mn(e,t,n+1)},10)}function Fn(e){Nn=void 0;const t=jn.shift();t&&Mn(t,e)}function Hn(e){const[,t]=e.split("--");return!t||ee(Number(t),X())>1e3}const zn=J;function Gn(e){switch(e.sessionPersistence){case Sn:return An(e);case kn:return Pn();case void 0:{let t=An(e);return!t&&e.allowFallbackToLocalStorage&&(t=Pn()),t}default:r.error(`Invalid session persistence '${String(e.sessionPersistence)}'`)}}function Wn(e,t,n,o,r=function(e,t){return e.type===Sn?function(e,t){const n={isLockEnabled:0===(null!=ln?ln:ln=function(e=window){var t;const n=e.navigator.userAgent;return e.chrome||/HeadlessChrome/.test(n)?0:0===(null===(t=e.navigator.vendor)||void 0===t?void 0:t.indexOf("Apple"))||/safari/i.test(n)&&!/chrome|android/i.test(n)?1:2}()),persistSession:n=>In(t,e,n,wn),retrieveSession:()=>Ln(t,e),expireSession:n=>In(t,e,Cn(n,e),vn)};return function(e){if(!mn(hn)){const t=mn("_dd"),n=mn("_dd_r"),o=mn("_dd_l"),r={};t&&(r.id=t),o&&/^[01]$/.test(o)&&(r.logs=o),n&&/^[012]$/.test(n)&&(r.rum=n),En(r)&&(Rn(r),e.persistSession(r))}}(n),n}(t,e.cookieOptions):function(e){return{isLockEnabled:!1,persistSession:Dn,retrieveSession:Bn,expireSession:t=>function(e,t){Dn(Cn(e,t))}(t,e)}}(t)}(e,t)){const s=new w,i=new w,a=new w,c=T(function(){const e=r.retrieveSession();Tn(e)?Mn({process:e=>Tn(e)?Cn(e,t):void 0,after:f},r):f(e)},zn);let u;g();const{throttled:l,cancel:d}=function(e){let t,n,o=!1;return{throttled:(...r)=>{o?t=r:(e(...r),o=!0,n=_(()=>{t&&e(...t),o=!1,t=void 0},1e3))},cancel:()=>{E(n),o=!1,t=void 0}}}(()=>{Mn({process:e=>{if(_n(e))return;const t=f(e);return function(e){if(_n(e))return!1;const t=o(e[n]);e[n]=t,delete e.isExpired,"0"===t||e.id||(e.id=an(),e.created=String(Z()))}(t),t},after:e=>{En(e)&&!p()&&function(e){u=e,s.notify()}(e),u=e}},r)});function f(e){return Tn(e)&&(e=Cn(e,t)),p()&&(function(e){return u.id!==e.id||u[n]!==e[n]}(e)?(u=Cn(u,t),i.notify()):(a.notify({previousState:u,newState:e}),u=e)),e}function g(){Mn({process:e=>{if(_n(e))return e.anonymousId=an(),Cn(e,t)},after:e=>{u=e}},r)}function p(){return void 0!==(null==u?void 0:u[n])}return{expandOrRenewSession:l,expandSession:function(){Mn({process:e=>p()?f(e):void 0},r)},getSession:()=>u,renewObservable:s,expireObservable:i,sessionStateUpdateObservable:a,restartSession:g,expire:e=>{d(),!1===e&&u&&delete u.anonymousId,r.expireSession(u),f(Cn(u,t))},stop:()=>{R(c)},updateSessionState:function(e){Mn({process:t=>({...t,...e}),after:f},r)}}}const Vn=["chrome-extension://","moz-extension://"];function Jn(e){return Vn.some(t=>e.includes(t))}function Kn(e,t,n){const o=function(e,t){const n=`/api/v2/${t}`,o=e.proxy;if("string"==typeof o){const e=en(o);return t=>`${e}?ddforward=${encodeURIComponent(`${n}?${t}`)}`}if("function"==typeof o)return e=>o({path:n,parameters:e});const r=function(e,t){const{site:n=Le,internalAnalyticsSubdomain:o}=t;if("logs"===e&&t.usePciIntake&&n===Le)return"pci.browser-intake-datadoghq.com";if(o&&n===Le)return`${o}.${Le}`;if("dd0g-gov.com"===n)return`http-intake.logs.${n}`;const r=n.split("."),s=r.pop();return`browser-intake-${r.join("-")}.${s}`}(t,e);return e=>`https://${r}${n}?${e}`}(e,t);return{build(r,s){const i=function({clientToken:e,internalAnalyticsSubdomain:t,source:n="browser"},o,r,{retry:s,encoding:i},a=[]){const c=[`ddsource=${n}`,`dd-api-key=${e}`,`dd-evp-origin-version=${encodeURIComponent("dev")}`,"dd-evp-origin=browser",`dd-request-id=${an()}`].concat(a);return i&&c.push(`dd-evp-encoding=${i}`),"rum"===o&&(c.push(`batch_time=${X()}`,`_dd.api=${r}`),s&&c.push(`_dd.retry_count=${s.count}`,`_dd.retry_after=${s.lastFailureStatus}`)),t&&c.reverse(),c.join("&")}(e,t,r,s,n);return o(i)},trackType:t}}function Zn(e){const t=e.site||Le,n=function(e){return"flutter"===e||"unity"===e||"dd_debugger"===e?e:"browser"}(e.source),o=function(e){return{logsEndpointBuilder:Kn(e,"logs"),rumEndpointBuilder:Kn(e,"rum"),profilingEndpointBuilder:Kn(e,"profile"),sessionReplayEndpointBuilder:Kn(e,"replay"),exposuresEndpointBuilder:Kn(e,"exposures"),flagEvaluationEndpointBuilder:Kn(e,"flagevaluation")}}({...e,site:t,source:n}),r=function(e){if(!e.replica)return;const t={...e,site:Le,clientToken:e.replica.clientToken};return{logsEndpointBuilder:Kn(t,"logs"),rumEndpointBuilder:Kn(t,"rum",[`application.id=${e.replica.applicationId}`])}}({...e,site:t,source:n});return{replica:r,site:t,source:n,...o}}function Xn(e,t){return null==e||"string"==typeof e||(r.error(`${t} must be defined as a string`),!1)}function Yn(e,t){return!!(void 0===e||(n=e,function(e){return"number"==typeof e}(n)&&n>=0&&n<=100))||(r.error(`${t} Sample Rate should be a number between 0 and 100`),!1);var n}function Qn(e,t){var n,o,i,u,l,d,f,g,p,m;if(e&&e.clientToken)if(void 0===e.allowedTrackingOrigins||Array.isArray(e.allowedTrackingOrigins)){if((!(y=e.site)||"string"!=typeof y||/(datadog|ddog|datad0g|dd0g)/.test(y)||(r.error(`Site should be a valid Datadog site. ${a} ${s}/getting_started/site/.`),0))&&Yn(e.sessionSampleRate,"Session")&&Yn(e.telemetrySampleRate,"Telemetry")&&Yn(e.telemetryConfigurationSampleRate,"Telemetry Configuration")&&Yn(e.telemetryUsageSampleRate,"Telemetry Usage")&&Xn(e.version,"Version")&&Xn(e.env,"Env")&&Xn(e.service,"Service")&&function(e,t,n=("undefined"!=typeof location?location.origin:"")){const o=e.allowedTrackingOrigins;if(!o)return!function(e,t=""){return!Jn(e)&&Jn(t.split("\n").filter(e=>{const t=e.trim();return t.length&&/^at\s+|@/.test(t)})[1]||"")}(n,t)||(r.error("Running the Browser SDK in a Web extension content script is forbidden unless the `allowedTrackingOrigins` option is provided."),!1);const s=function(e,t,n=!1){return e.some(e=>{try{if("function"==typeof e)return e(t);if(e instanceof RegExp)return e.test(t);if("string"==typeof e)return n?t.startsWith(e):e===t}catch(e){r.error(e)}return!1})}(o,n);return s||r.error("SDK initialized on a non-allowed domain."),s}(e,null!=t?t:"")){var y;if(void 0===e.trackingConsent||Ce(x,e.trackingConsent))return{beforeSend:e.beforeSend&&c(e.beforeSend,"beforeSend threw an error:"),sessionStoreStrategyType:h?void 0:Gn(e),sessionSampleRate:null!==(n=e.sessionSampleRate)&&void 0!==n?n:100,telemetrySampleRate:null!==(o=e.telemetrySampleRate)&&void 0!==o?o:20,telemetryConfigurationSampleRate:null!==(i=e.telemetryConfigurationSampleRate)&&void 0!==i?i:5,telemetryUsageSampleRate:null!==(u=e.telemetryUsageSampleRate)&&void 0!==u?u:5,service:null!==(l=e.service)&&void 0!==l?l:void 0,env:null!==(d=e.env)&&void 0!==d?d:void 0,version:null!==(f=e.version)&&void 0!==f?f:void 0,datacenter:null!==(g=e.datacenter)&&void 0!==g?g:void 0,silentMultipleInit:!!e.silentMultipleInit,allowUntrustedEvents:!!e.allowUntrustedEvents,trackingConsent:null!==(p=e.trackingConsent)&&void 0!==p?p:x.GRANTED,trackAnonymousUser:null===(m=e.trackAnonymousUser)||void 0===m||m,storeContextsAcrossPages:!!e.storeContextsAcrossPages,betaEncodeCookieOptions:!!e.betaEncodeCookieOptions,variant:e.variant,sdkVersion:e.sdkVersion,...Zn(e)};r.error('Tracking Consent should be either "granted" or "not-granted"')}}else r.error("Allowed Tracking Origins must be an array");else r.error("Client Token is not configured, we will not send any data.")}const eo={intervention:"intervention",deprecation:"deprecation",cspViolation:"csp_violation"};function to(e){return{startClocks:Q(),source:ke,handling:"unhandled",...e}}function no(e,t,n,o,r){return n?G({name:e,message:t,stack:[{func:"?",url:n,line:null!=o?o:void 0,column:null!=r?r:void 0}]}):void 0}function oo(e,t,n){return void 0===e?[]:"all"===e||Array.isArray(e)&&e.every(e=>t.includes(e))?"all"===e?t:function(e){const t=new Set;return e.forEach(e=>t.add(e)),Array.from(t)}(e):void r.error(`${n} should be "all" or an array with allowed values "${t.join('", "')}"`)}function ro(t,n,o){const s=function(){const e=[];return{add:t=>{e.push(t)>500&&e.splice(0,1)},remove:t=>{Jt(e,t)},drain:t=>{e.forEach(e=>e(t)),e.length=0}}}(),i=Xt();Et(i,Rt,s);const a=Yt();Et(a,$t,s);const c=Qt();let u,l;Et(c,Tt,s);const d=n.observable.subscribe(f);function f(){if(!l||!u||!n.isGranted())return;d.unsubscribe();const e=o(u,l);s.drain(e)}return{init(t,o){if(!t)return void r.error("Missing configuration");if(s=t.enableExperimentalFeatures,Array.isArray(s)&&s.filter(e=>Ce(Ee,e)).forEach(e=>{Te.add(e)}),He()&&(t=function(e){return{...e,clientToken:"empty"}}(t)),u=t,function(e){ht().notify({rawEvent:{type:gt,configuration:e}})}(function(e){const t={session_sample_rate:(n=e).sessionSampleRate,telemetry_sample_rate:n.telemetrySampleRate,telemetry_configuration_sample_rate:n.telemetryConfigurationSampleRate,telemetry_usage_sample_rate:n.telemetryUsageSampleRate,use_before_send:!!n.beforeSend,use_partitioned_cross_site_session_cookie:n.usePartitionedCrossSiteSessionCookie,use_secure_session_cookie:n.useSecureSessionCookie,use_proxy:!!n.proxy,silent_multiple_init:n.silentMultipleInit,track_session_across_subdomains:n.trackSessionAcrossSubdomains,track_anonymous_user:n.trackAnonymousUser,session_persistence:n.sessionPersistence,allow_fallback_to_local_storage:!!n.allowFallbackToLocalStorage,store_contexts_across_pages:!!n.storeContextsAcrossPages,allow_untrusted_events:!!n.allowUntrustedEvents,tracking_consent:n.trackingConsent,use_allowed_tracking_origins:Array.isArray(n.allowedTrackingOrigins),beta_encode_cookie_options:n.betaEncodeCookieOptions,source:n.source,sdk_version:n.sdkVersion,variant:n.variant};var n;return{forward_errors_to_logs:e.forwardErrorsToLogs,forward_console_logs:e.forwardConsoleLogs,forward_reports:e.forwardReports,use_pci_intake:e.usePciIntake,...t}}(t)),l)return void Pt("DD_LOGS",t);var s;const i=function(t,n){!0===t.usePciIntake&&t.site&&"datadoghq.com"!==t.site&&r.warn("PCI compliance for Logs is only available for Datadog organizations in the US1 site. Default intake will be used.");const o=Qn(t,n),s=oo(t.forwardConsoleLogs,ze(e),"Forward Console Logs"),i=oo(t.forwardReports,ze(eo),"Forward Reports");if(o&&s&&i)return t.forwardErrorsToLogs&&!s.includes(e.error)&&s.push(e.error),{forwardErrorsToLogs:!1!==t.forwardErrorsToLogs,forwardConsoleLogs:s,forwardReports:i,requestErrorResponseLengthLimit:32768,...o}}(t,o);i&&(l=i,sn().subscribe($),n.tryToInit(i.trackingConsent),f())},get initConfiguration(){return u},globalContext:i,accountContext:a,userContext:c,getInternalContext:$,handleLog(e,n,o,r=t(),i=X()){s.add(t=>t.handleLog(e,n,o,r,i))},get lifeCycle(){}}}function so(){let e="",t=0;return{isAsync:!1,get isEmpty(){return!e},write(n,o){const r=re(n);t+=r,e+=n,o&&o(r)},finish(e){e(this.finishSync())},finishSync(){const n={output:e,outputBytesCount:t,rawBytesCount:t,pendingData:""};return e="",t=0,n},estimateEncodedBytesCount:e=>e.length}}function io(){return!h&&Boolean(b._DATADOG_SYNTHETICS_INJECTS_RUM||mn("datadog-synthetics-injects-rum"))}const ao=1/0;let co=null;const uo=new Set;const lo=vn;let fo=[];function go(e,t,n,o){const r=new w,s=new w,i=Wn(e.sessionStoreStrategyType,e,t,n);fo.push(()=>i.stop());const a=function({expireDelay:e,maxEntries:t}){let n=[];co||(co=T(()=>{uo.forEach(e=>e())},6e4));const o=()=>{const t=Y()-e;for(;n.length>0&&n[n.length-1].endTime<t;)n.pop()};return uo.add(o),{add:function(e,o){const r={value:e,startTime:o,endTime:ao,remove:()=>{Jt(n,r)},close:e=>{r.endTime=e}};return t&&n.length>=t&&n.pop(),n.unshift(r),r},find:function(e=1/0,t={returnInactive:!1}){for(const o of n)if(o.startTime<=e){if(t.returnInactive||e<=o.endTime)return o.value;break}},closeActive:function(e){const t=n[0];t&&t.endTime===ao&&t.close(e)},findAll:function(e=1/0,t=0){const o=e+t;return n.filter(t=>t.startTime<=o&&e<=t.endTime).map(e=>e.value)},reset:function(){n=[]},stop:function(){uo.delete(o),0===uo.size&&co&&(R(co),co=null)}}}({expireDelay:lo});if(fo.push(()=>a.stop()),i.renewObservable.subscribe(()=>{a.add(c(),Y()),r.notify()}),i.expireObservable.subscribe(()=>{s.notify(),a.closeActive(Y())}),i.expandOrRenewSession(),a.add(c(),[0,ne()][0]),Re(Ee.SHORT_SESSION_INVESTIGATION)){const t=i.getSession();t&&function(e,t){if(!window.cookieStore||!t.created)return;const n=Number(t.created),o=Z(),{stop:r}=Ge(e,cookieStore,"change",function(e){const s=function(e,t){for(let n=e.length-1;n>=0;n-=1){const o=e[n];if(t(o))return o}}(e.changed,e=>e.name===hn);if(!s)return;const i=Z()-n;if(i>84e4)r();else{const e=On(s.value);if(e.id&&e.id!==t.id){r();const n=Z()-o;po().then(o=>{wt("Session cookie changed",{time:n,session_age:i,old:t,new:e,cookie:o})}).catch(p)}}});fo.push(r)}(e,t)}function c(){const n=i.getSession();return n?{id:n.id,trackingType:n[t],isReplayForced:!!n.forcedReplay,anonymousId:n.anonymousId}:(async function(e){const t=e.sessionStoreStrategyType;if(!t)return;let n,o;t.type===Sn?(n=Ln(t.cookieOptions,e),o={cookie:await po(),currentDomain:`${window.location.protocol}//${window.location.hostname}`}):n=Bn(),wt("Unexpected session state",{sessionStoreStrategyType:t.type,session:n,isSyntheticsTest:Boolean(function(){const e=window._DATADOG_SYNTHETICS_PUBLIC_ID||mn("datadog-synthetics-public-id");return"string"==typeof e?e:void 0}()&&function(){const e=window._DATADOG_SYNTHETICS_RESULT_ID||mn("datadog-synthetics-result-id");return"string"==typeof e?e:void 0}()),createdTimestamp:null==n?void 0:n.created,expireTimestamp:null==n?void 0:n.expire,...o})}(e).catch(()=>{}),{id:"invalid",trackingType:"0",isReplayForced:!1,anonymousId:void 0})}return o.observable.subscribe(()=>{o.isGranted()?i.expandOrRenewSession():i.expire(!1)}),function(e){const{stop:t}=We(e,window,["click","touchstart","keydown","scroll"],()=>{o.isGranted()&&i.expandOrRenewSession()},{capture:!0,passive:!0});fo.push(t)}(e),function(e){const t=()=>{"visible"===document.visibilityState&&i.expandSession()},{stop:n}=Ge(e,document,"visibilitychange",t);fo.push(n);const o=T(t,6e4);fo.push(()=>{R(o)})}(e),function(e){const{stop:t}=Ge(e,window,"resume",()=>i.restartSession(),{capture:!0});fo.push(t)}(e),{findSession:(e,t)=>a.find(e,t),renewObservable:r,expireObservable:s,sessionStateUpdateObservable:i.sessionStateUpdateObservable,expire:i.expire,updateSessionState:i.updateSessionState}}async function po(){let e;return e="cookieStore"in window?await window.cookieStore.getAll(hn):document.cookie.split(/\s*;\s*/).filter(e=>e.startsWith(hn)),{count:e.length,domain:bn()||"undefined",...e}}function mo(e,t){return"0"===(n=t)||"1"===n?t:De(e.sessionSampleRate)?"1":"0";var n}function yo(e,t,n,o,r,s){const i=zt.concat(["custom"]),a={};i.forEach(e=>{a[e]=function(e,t,n=3e3){let o=0,r=!1;return{isLimitReached(){if(0===o&&_(()=>{o=0},K),o+=1,o<=n||r)return r=!1,!1;if(o===n+1){r=!0;try{t({message:`Reached max number of ${e}s by minute: ${n}`,source:he,startClocks:Q()})}finally{r=!1}}return!0}}}(e,r,s)}),t.subscribe(0,({rawLogsEvent:r,messageContext:s,savedCommonContext:i,domainContext:c,ddtags:u=[]})=>{var l,d;const f=r.date-ne(),g=i||o(),p=n.triggerHook(0,{startTime:f});if(p===lt)return;const m=Oe(e),y=Me({view:g.view},p,r,s,{ddtags:m.concat(u).join(",")});!1===(null===(l=e.beforeSend)||void 0===l?void 0:l.call(e,y,c))||y.origin!==he&&(null!==(d=a[y.status])&&void 0!==d?d:a.custom).isLimitReached()||t.notify(1,y)})}let bo={};const ho={[e.log]:Mt.info,[e.debug]:Mt.debug,[e.info]:Mt.info,[e.warn]:Mt.warn,[e.error]:Mt.error};let vo;const wo=new WeakMap;function So({target:e,parameters:[t,n]}){wo.set(e,{state:"open",method:String(t).toUpperCase(),url:en(String(n))})}function ko({target:e}){const t=wo.get(e);t&&(t.isAborted=!0)}const xo="fetch",Co="xhr";function _o(e,t){if(!e.forwardErrorsToLogs)return{stop:$};const n=(h?new w:function(e){return vo||(vo=function(e){return new w(t=>{const{stop:n}=V(XMLHttpRequest.prototype,"open",So),{stop:o}=V(XMLHttpRequest.prototype,"send",n=>{!function({target:e,parameters:[t],handlingStack:n},o,r){const s=wo.get(e);if(!s)return;const i=s;i.state="start",i.startClocks=Q(),i.isAborted=!1,i.xhr=e,i.handlingStack=n,i.requestBody=t;let a=!1;const{stop:c}=V(e,"onreadystatechange",()=>{e.readyState===XMLHttpRequest.DONE&&u()}),u=()=>{if(l(),c(),a)return;a=!0;const t=s;var n;t.state="complete",t.duration=ee(i.startClocks.timeStamp,X()),t.status=e.status,"string"==typeof e.response&&(t.responseBody=e.response),r.notify((n=t,{...n}))},{stop:l}=Ge(o,e,"loadend",u);r.notify(i)}(n,e,t)},{computeHandlingStack:!0}),{stop:r}=V(XMLHttpRequest.prototype,"abort",ko);return()=>{n(),o(),r()}})}(e)),vo}(e)).subscribe(e=>{"complete"===e.state&&s(Co,e)}),o=sn({responseBodyAction:e=>r(e)?2:0}).subscribe(e=>{"resolve"===e.state&&s(xo,e)});function r(e){return t=e.url,!qe.every(e=>t.includes(e))&&(function(e){return 0===e.status&&"opaque"!==e.responseType}(e)||Ze(e.status));var t}function s(n,o){if(!r(o))return;const s="error"in o&&o.error?G(A(o.error)):o.responseBody||"Failed to load",i={isAborted:o.isAborted,handlingStack:o.handlingStack};t.notify(0,{rawLogsEvent:{message:`${Eo(n)} error ${o.method} ${o.url}`,date:o.startClocks.timeStamp,error:{stack:un(s,e.requestErrorResponseLengthLimit,"..."),handling:void 0},http:{method:o.method,status_code:o.status,url:o.url},status:Mt.error,origin:"network"},domainContext:i})}return{stop:()=>{n.unsubscribe(),o.unsubscribe()}}}function Eo(e){return Co===e?"XHR":"Fetch"}const To=class{constructor(){this.callbacks={}}notify(e,t){const n=this.callbacks[e];n&&n.forEach(e=>e(t))}subscribe(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),{unsubscribe:()=>{this.callbacks[e]=this.callbacks[e].filter(e=>t!==e)}}}};const Ro={[Mt.ok]:e.debug,[Mt.debug]:e.debug,[Mt.info]:e.info,[Mt.notice]:e.info,[Mt.warn]:e.warn,[Mt.error]:e.error,[Mt.critical]:e.error,[Mt.alert]:e.error,[Mt.emerg]:e.error},$o="logs",Oo=function(){const o=function(e){const t=new w;return{tryToInit(t){e||(e=t)},update(n){e=n,t.notify()},isGranted:()=>e===x.GRANTED,observable:t}}(),r=function(e=xe){const t=new k(500),n=e().subscribe(e=>{t.notify({type:0,error:e})});return{observable:t,stop:()=>{n.unsubscribe()}}}().observable;let s=ro(Vt,o,(i,a)=>{const c=function(o,r,s,i){const a=new To,c=function(){const e={};return{register:(t,n)=>(e[t]||(e[t]=[]),e[t].push(n),{unregister:()=>{e[t]=e[t].filter(e=>e!==n)}}),triggerHook(t,n){const o=e[t]||[],r=[];for(const e of o){const t=e(n);if(t===lt)return lt;t!==dt&&r.push(t)}return Me(...r)}}}(),u=[];a.subscribe(1,e=>Pe("logs",e));const l=function(e){return t=>{e.notify(0,{rawLogsEvent:{message:t.message,date:t.startClocks.timeStamp,origin:he,status:Mt.error}}),wt("Error reported to customer",{"error.message":t.message})}}(a),d=h?new w:function(e){return new w(t=>{const{stop:n}=We(e,window,["visibilitychange","freeze"],e=>{"visibilitychange"===e.type&&"hidden"===document.visibilityState?t.notify({reason:Ve.HIDDEN}):"freeze"===e.type&&t.notify({reason:Ve.FROZEN})},{capture:!0}),o=Ge(e,window,"beforeunload",()=>{t.notify({reason:Ve.UNLOADING})}).stop;return()=>{n(),o()}})}(o),p=vt("browser-logs-sdk",o,c,l,d,so);u.push(p.stop);const m=!o.sessionStoreStrategyType||He()||io()?function(e){const t="1"===mo(e)?{}:void 0;return{findTrackedSession:()=>t,expireObservable:new w}}(o):function(e,t){const n=go(e,"logs",t=>mo(e,t),t);return{findTrackedSession:(e,t={returnInactive:!1})=>{const o=n.findSession(e,t);return o&&"1"===o.trackingType?{id:o.id,anonymousId:o.anonymousId}:void 0},expireObservable:n.expireObservable}}(o,s);!function(e,t){function n(){return t.isGranted()?dt:lt}e.register(0,n),e.register(1,n)}(c,s),function(e,t,n){e.register(0,({startTime:e})=>{const o=n.findTrackedSession(e);return n.findTrackedSession(e,{returnInactive:!0})?{service:t.service,session_id:o?o.id:void 0,session:o?{id:o.id}:void 0}:lt}),e.register(1,({startTime:e})=>{const t=n.findTrackedSession(e);return t&&t.id?{session:{id:t.id}}:dt})}(c,o,m);const y=function(e,t,n){const o=Yt();return t.storeContextsAcrossPages&&Zt(t,o,n,4),e.register(0,()=>{const e=o.getContext();return _e(e)||!e.id?dt:{account:e}}),o}(c,o,$o),v=function(e,t,n,o){const r=Qt();return t.storeContextsAcrossPages&&Zt(t,r,o,1),e.register(0,({eventType:e,startTime:o})=>{const s=r.getContext(),i=n.findTrackedSession(o);return i&&i.anonymousId&&!s.anonymous_id&&t.trackAnonymousUser&&(s.anonymous_id=i.anonymousId),_e(s)?dt:{type:e,usr:s}}),e.register(1,({startTime:e})=>{var t;return{anonymous_id:null===(t=n.findTrackedSession(e))||void 0===t?void 0:t.anonymousId}}),r}(c,o,m,$o),k=function(e,t,n,o){const r=Xt();return t.storeContextsAcrossPages&&Zt(t,r,n,2),e.register(0,()=>{const e=r.getContext();return o?{context:e}:e}),r}(c,o,$o,!1);!function(e){const t=b;function n(e){const n=function(e,t){if(t&&t.getInternalContext)return t.getInternalContext(e)}(e,io()?t.DD_RUM_SYNTHETICS:t.DD_RUM);if(n)return n}e.register(0,({startTime:e})=>n(e)||dt),e.register(1,({startTime:e})=>{var t,o;const r=n(e);return r?{application:{id:r.application_id},view:{id:null===(t=r.view)||void 0===t?void 0:t.id},action:{id:null===(o=r.user_action)||void 0===o?void 0:o.id}}:dt})}(c),_o(o,a),function(e,t,n){if(!e.forwardErrorsToLogs)return{stop:$};n.subscribe(e=>{if(0===e.type){const n=e.error;t.notify(0,{rawLogsEvent:{message:n.message,date:n.startClocks.timeStamp,error:Ft(n),origin:Se,status:Mt.error},messageContext:n.context})}})}(o,a,i),i.unbuffer(),function(n,o){(r=n.forwardConsoleLogs,S(...r.map(n=>(bo[n]||(bo[n]=function(n){return new w(o=>{const r=t[n];return t[n]=(...t)=>{r.apply(console,t);const s=z("console error");g(()=>{o.notify(function(t,n,o){const r=t.map(e=>function(e){return"string"==typeof e?ae(e):ye(e)?W(A(e)):se(ae(e),void 0,2)}(e)).join(" ");if(n===e.error){const e=fe({originalError:t.find(ye),handlingStack:o,startClocks:Q(),source:ve,handling:"handled",nonErrorPrefix:"Provided",useFallbackStack:!1});return e.message=r,{api:n,message:r,handlingStack:o,error:e}}return{api:n,message:r,error:void 0,handlingStack:o}}(t,n,s))})},()=>{t[n]=r}})}(n)),bo[n])))).subscribe(e=>{var t;const n={rawLogsEvent:{date:X(),message:e.message,origin:ve,error:e.error&&Ft(e.error),status:ho[e.api]},messageContext:null===(t=e.error)||void 0===t?void 0:t.context,domainContext:{handlingStack:e.handlingStack}};o.notify(0,n)});var r}(o,a),function(e,t){(function(e,t){const n=[];t.includes(eo.cspViolation)&&n.push(function(e){return new w(t=>{const{stop:n}=Ge(e,document,"securitypolicyviolation",e=>{t.notify(function(e){const t=`'${e.blockedURI}' blocked by '${e.effectiveDirective}' directive`;return to({type:e.effectiveDirective,message:`${eo.cspViolation}: ${t}`,originalError:e,csp:{disposition:e.disposition},stack:no(e.effectiveDirective,e.originalPolicy?`${t} of the policy "${un(e.originalPolicy,100,"...")}"`:"no policy",e.sourceFile,e.lineNumber,e.columnNumber)})}(e))});return n})}(e));const o=t.filter(e=>e!==eo.cspViolation);return o.length&&n.push(function(e){return new w(t=>{if(!window.ReportingObserver)return;const n=f((e,n)=>e.forEach(e=>t.notify(function(e){const{type:t,body:n}=e;return to({type:n.id,message:`${t}: ${n.message}`,originalError:e,stack:no(n.id,n.message,n.sourceFile,n.lineNumber,n.columnNumber)})}(e)))),o=new window.ReportingObserver(n,{types:e,buffered:!0});return o.observe(),()=>{o.disconnect()}})}(o)),S(...n)})(e,e.forwardReports).subscribe(e=>{let n,o=e.message;const r="deprecation"===e.originalError.type?Mt.warn:Mt.error;var s,i;r===Mt.error?n=Ft(e):e.stack&&(o+=` Found in ${s=e.stack,null===(i=/@ (.+)/.exec(s))||void 0===i?void 0:i[1]}`),t.notify(0,{rawLogsEvent:{date:X(),message:o,origin:ke,error:n,status:r}})})}(o,a);const{handleLog:x}=function(e){return{handleLog:function(o,r,s,i,a){const c=Me(r.getContext(),o.context);if(Nt(o.status,"console",r)&&function({status:e,message:o},r){n[Ro[e]].call(t,o,r)}(o,c),Nt(o.status,Ht,r)){const t={rawLogsEvent:{date:a||X(),message:o.message,status:o.status,origin:we},messageContext:c,savedCommonContext:i,ddtags:r.getTags()};s&&(t.domainContext={handlingStack:s}),e.notify(0,t)}}}}(a);if(yo(o,a,c,r,l),He())!function(e){const t=Fe();e.subscribe(1,e=>{t.send("log",e)})}(a);else{const{stop:e}=function(e,t,n,o,r){const s=[e.logsEndpointBuilder];e.replica&&s.push(e.replica.logsEndpointBuilder);const i=Je({encoder:so(),request:ot(s,n),flushController:ut({pageMayExitObservable:o,sessionExpireObservable:r.expireObservable})});return t.subscribe(1,e=>{i.add(e)}),i}(o,a,l,d,m);u.push(()=>e())}var C;return{handleLog:x,getInternalContext:(C=m,{get:e=>{const t=C.findTrackedSession(e);if(t)return{session_id:t.id}}}).get,accountContext:y,globalContext:k,userContext:v,lifeCycle:a,stop:()=>{u.forEach(e=>e())}}}(a,Vt,o,r);return s=function(e,t){return{init:e=>{Pt("DD_LOGS",e)},initConfiguration:e,...t}}(i,c),c});const i=()=>s,a={};return function(e){const t={version:"dev",onReady(e){e()},...e};return Object.defineProperty(t,"_setDebug",{get:()=>d,enumerable:!1}),t}({logger:new Gt((...e)=>s.handleLog(...e)),init:e=>{const t=(new Error).stack;g(()=>s.init(e,t))},setTrackingConsent:f(e=>{o.update(e),kt({feature:"set-tracking-consent",tracking_consent:e})}),getGlobalContext:_t(i,Rt,Ot),setGlobalContext:_t(i,Rt,At),setGlobalContextProperty:_t(i,Rt,It),removeGlobalContextProperty:_t(i,Rt,Lt),clearGlobalContext:_t(i,Rt,qt),createLogger:f((e,t={})=>(a[e]=new Gt((...e)=>s.handleLog(...e),ae(e),t.handler,t.level,ae(t.context)),a[e])),getLogger:f(e=>a[e]),getInitConfiguration:f(()=>Ne(s.initConfiguration)),getInternalContext:f(e=>s.getInternalContext(e)),sendRawLog:f(e=>{s.lifeCycle&&s.lifeCycle.notify(1,e)}),setUser:_t(i,Tt,At),getUser:_t(i,Tt,Ot),setUserProperty:_t(i,Tt,It),removeUserProperty:_t(i,Tt,Lt),clearUser:_t(i,Tt,qt),setAccount:_t(i,$t,At),getAccount:_t(i,$t,Ot),setAccountProperty:_t(i,$t,It),removeAccountProperty:_t(i,$t,Lt),clearAccount:_t(i,$t,qt)})}();!function(e,t,n){const o=e[t];o&&!o.q&&o.version&&r.warn("SDK is loaded more than once. This is unsupported and might have unexpected behavior."),e[t]=n,o&&o.q&&o.q.forEach(e=>c(e,"onReady callback threw an error:")())}(y(),"DD_LOGS",Oo);Oo.init({clientToken:"pub74fd472504982beb427b647893758040",site:"datadoghq.com",service:"browser-sdk-developer-extension",env:"prod",version:"6.24.1",sessionSampleRate:100,telemetrySampleRate:100,sessionPersistence:"local-storage",forwardErrorsToLogs:!0,forwardConsoleLogs:"all"}),Oo.setGlobalContext({context:"background"});const Ao="Datadog Browser SDK extension:";function Io(e){return{log(...t){console.log(Ao,`[${e}]`,...t)},error(...t){console.error(Ao,`[${e}]`,...t)}}}class Lo{listeners=new Set;subscribe(e){return this.listeners.add(e),{unsubscribe:()=>{this.listeners.delete(e)}}}notify(e){this.listeners.forEach(t=>t(e))}}const qo=Io("devtoolsPanelConnection"),Po=new Map,Do=/^devtools-panel-for-tab-(\d+)$/,Bo=new Lo,jo=new Lo,No=new Lo,Mo=new Lo,Uo=new Lo;chrome.runtime.onConnect.addListener(e=>{const t=Do.exec(e.name);if(!t)return;const n=Number(t[1]);qo.log(`New devtools connection for tab ${n}`),Po.set(n,e),1===Po.size&&Bo.notify(n),No.notify(n),e.onMessage.addListener(e=>{Uo.notify(e)}),e.onDisconnect.addListener(()=>{qo.log(`Remove devtools connection for tab ${n}`),Po.delete(n),Mo.notify(n),0===Po.size&&jo.notify(n)})});const Fo=Io("messageRelay"),Ho=[{id:"browser-sdk-content-script-main",world:chrome.scripting.ExecutionWorld.MAIN,file:"./content-script-main.js"},{id:"browser-sdk-content-script-isolated",world:chrome.scripting.ExecutionWorld.ISOLATED,file:"./content-script-isolated.js"}];async function zo(){Fo.log("Unregistering content scripts");try{await chrome.scripting.unregisterContentScripts({ids:Ho.map(e=>e.id)})}catch{}}Bo.subscribe(e=>{(async function(e){await zo(),Fo.log("Registering content scripts"),await chrome.scripting.registerContentScripts(Ho.map(e=>({id:e.id,allFrames:!0,js:[e.file],matches:["<all_urls>"],world:e.world,runAt:"document_start"}))),await Promise.all(Ho.map(t=>chrome.scripting.executeScript({files:[t.file],world:t.world,target:{tabId:e,allFrames:!0}})))})(e).catch(e=>Fo.error("Error while registering content scripts:",e))}),jo.subscribe(()=>{zo().catch(e=>Fo.error("Error while unregistering content scripts:",e))}),chrome.runtime.onMessage.addListener((e,t)=>{t.tab&&t.tab.id&&function(e,t){const n=Po.get(e);n&&n.postMessage(t)}(t.tab.id,{type:"sdk-message",message:e})});const Go="http://localhost:8080",Wo=`${Go}/datadog-rum-slim.js`,Vo=`${Go}/datadog-rum.js`,Jo=["iam-rum-intake.datadoghq.com","browser-intake-datad0g.com","browser-intake-datadoghq.com","browser-intake-datadoghq.eu","browser-intake-ddog-gov.com","browser-intake-us3-datadoghq.com","browser-intake-us5-datadoghq.com",...["com","eu"].flatMap(e=>[`public-trace-http-intake.logs.datadoghq.${e}`,`rum-http-intake.logs.datadoghq.${e}`,`browser-http-intake.logs.datadoghq.${e}`])],Ko=Io("syncRules");async function Zo(e){const t=await chrome.declarativeNetRequest.getSessionRules();let n=1;const o=[];for(const r of t)r.condition.tabIds?.includes(e)?o.push(r.id):n=r.id+1;return{tabRuleIds:o,nextRuleId:n}}function Xo({tabId:e,useDevBundles:t,useRumSlim:n,blockIntakeRequests:o},r){const s=[];let i=r;if("cdn"===t){const e=n?Wo:Vo;Ko.log("add redirect to dev bundles rules"),s.push(a(/^https:\/\/.*\/datadog-(rum|rum-slim|logs)(-[\w-]+)?\.js$/,{regexSubstitution:`${Go}/datadog-\\1.js`}),a(/^https:\/\/.*\/chunks\/(\w+)(-\w+)?-datadog-rum.js$/,{regexSubstitution:`${Go}/chunks/\\1-datadog-rum.js`}),a("https://localhost:8443/static/datadog-rum-hotdog.js",{url:e}))}else n&&(Ko.log("add redirect to rum slim rule"),s.push(a(/^(https:\/\/.*\/datadog-rum)(-slim)?/,{regexSubstitution:"\\1-slim"})));if(o){Ko.log("add block intake rules");for(const t of Jo)s.push({id:i++,condition:{tabIds:[e],urlFilter:`||${t}`},action:{type:chrome.declarativeNetRequest.RuleActionType.BLOCK}})}function a(t,n){const o=[e];return{id:i++,action:{type:chrome.declarativeNetRequest.RuleActionType.REDIRECT,redirect:n},condition:"string"==typeof t?{tabIds:o,urlFilter:`|${t}|`}:{tabIds:o,regexFilter:t.source}}}return s}Mo.subscribe(e=>{(async function(e){Ko.log(`Clearing rules for tab ${e}`);const{tabRuleIds:t}=await Zo(e);await chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:t}),await chrome.browsingData.removeCache({})})(e).catch(e=>Ko.error("Error while clearing rules:",e))}),Uo.subscribe(e=>{"update-net-request-rules"===e.type&&async function(e){Ko.log(`Updating rules for tab ${e.tabId}`);const{tabRuleIds:t,nextRuleId:n}=await Zo(e.tabId);await chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:t,addRules:Xo(e,n)}),await chrome.browsingData.removeCache({})}(e.options).catch(e=>Ko.error("Error while updating rules:",e))})})();