"use strict";(self.webpackChunk_datadog_browser_sdk_developer_extension=self.webpackChunk_datadog_browser_sdk_developer_extension||[]).push([[777],{6:(t,e,n)=>{n.d(e,{startRecording:()=>yt});var o=n(8583),s=n(1782),r=n(4976),i=n(1072),a=n(4599),u=n(6351),c=n(6563);const l={FullSnapshot:2,IncrementalSnapshot:3,Meta:4,Focus:6,ViewEnd:7,VisualViewport:8,FrustrationRecord:9},d={Document:0,DocumentType:1,Element:2,Text:3,CDATA:4,DocumentFragment:11},p={Mutation:0,MouseMove:1,MouseInteraction:2,Scroll:3,ViewportResize:4,Input:5,TouchMove:6,MediaInteraction:7,StyleSheetRule:8},f={MouseUp:0,MouseDown:1,Click:2,ContextMenu:3,DblClick:4,Focus:5,Blur:6,TouchStart:7,TouchEnd:9},m={Play:0,Pause:1};var h=n(815);function g(t){return Boolean(t.changedTouches)}function v(t){return!0===t.composed&&(0,h.XS)(t.target)?t.composedPath()[0]:t.target}const y=(t,e)=>{const n=window.visualViewport,o={layoutViewportX:t,layoutViewportY:e,visualViewportX:t,visualViewportY:e};return n?(function(t){return Math.abs(t.pageTop-t.offsetTop-window.scrollY)>25||Math.abs(t.pageLeft-t.offsetLeft-window.scrollX)>25}(n)?(o.layoutViewportX=Math.round(t+n.offsetLeft),o.layoutViewportY=Math.round(e+n.offsetTop)):(o.visualViewportX=Math.round(t-n.offsetLeft),o.visualViewportY=Math.round(e-n.offsetTop)),o):o},w=t=>({scale:t.scale,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,pageLeft:t.pageLeft,pageTop:t.pageTop,height:t.height,width:t.width});var S=n(5507);function x(t,e){return{data:{source:t,...e},type:l.IncrementalSnapshot,timestamp:(0,S.nx)()}}const T=50;function b(t,e,n){const{throttled:o,cancel:s}=(0,i.n)(t=>{const o=v(t),s=e.nodeIds.get(o);if(void 0===s)return;const r=E(t);if(!r)return;const i={id:s,timeOffset:0,x:r.x,y:r.y};n(x(g(t)?p.TouchMove:p.MouseMove,{positions:[i]}))},T,{trailing:!1}),{stop:r}=(0,c.l)(t,document,["mousemove","touchmove"],o,{capture:!0,passive:!0});return{stop:()=>{r(),s()}}}function E(t){let{clientX:e,clientY:n}=g(t)?t.changedTouches[0]:t;if(window.visualViewport){const{visualViewportX:t,visualViewportY:o}=y(e,n);e=t,n=o}if(Number.isFinite(e)&&Number.isFinite(n))return{x:e,y:n}}const I={pointerup:f.MouseUp,mousedown:f.MouseDown,click:f.Click,contextmenu:f.ContextMenu,dblclick:f.DblClick,focus:f.Focus,blur:f.Blur,touchstart:f.TouchStart,touchend:f.TouchEnd};function N(t,e,n,o){return(0,c.l)(t,document,Object.keys(I),s=>{const r=v(s),i=e.nodeIds.get(r);if(void 0===i||(0,h.PJ)(r,t.defaultPrivacyLevel)===h.$m.HIDDEN)return;const a=I[s.type];let u;if(a!==f.Blur&&a!==f.Focus){const t=E(s);if(!t)return;u={id:i,type:a,x:t.x,y:t.y}}else u={id:i,type:a};n({id:o.getIdForEvent(s),...x(p.MouseInteraction,u)})},{capture:!0,passive:!0})}const C=100;function R(t,e,n,o,s=document){const{throttled:r,cancel:a}=(0,i.n)(s=>{const r=v(s);if(!r)return;const i=e.nodeIds.get(r);if(void 0===i||(0,h.PJ)(r,t.defaultPrivacyLevel)===h.$m.HIDDEN)return;const a=r===document?{scrollTop:(0,h.zL)(),scrollLeft:(0,h.Gn)()}:{scrollTop:Math.round(r.scrollTop),scrollLeft:Math.round(r.scrollLeft)};o.set(r,a),n(x(p.Scroll,{id:i,x:a.scrollLeft,y:a.scrollTop}))},C),{stop:u}=(0,c.q)(t,s,"scroll",r,{capture:!0,passive:!0});return{stop:()=>{u(),a()}}}const D=200;function M(t,e){const n=(0,h.g1)(t).subscribe(t=>{e(x(p.ViewportResize,t))});return{stop:()=>{n.unsubscribe()}}}function _(t,e){const n=window.visualViewport;if(!n)return{stop:i.l};const{throttled:o,cancel:s}=(0,i.n)(()=>{e({data:w(n),type:l.VisualViewport,timestamp:(0,S.nx)()})},D,{trailing:!1}),{stop:r}=(0,c.l)(t,n,["resize","scroll"],o,{capture:!0,passive:!0});return{stop:()=>{r(),s()}}}function L(t,e,n){return(0,c.l)(t,document,["play","pause"],o=>{const s=v(o);if(!s)return;const r=e.nodeIds.get(s);void 0!==r&&(0,h.PJ)(s,t.defaultPrivacyLevel)!==h.$m.HIDDEN&&n(x(p.MediaInteraction,{id:r,type:"play"===o.type?m.Play:m.Pause}))},{capture:!0,passive:!0})}var O=n(487);function z(t,e){function n(e,n){if(!e||!e.ownerNode)return;const o=t.nodeIds.get(e.ownerNode);void 0!==o&&n(o)}const o=[(0,O.H)(CSSStyleSheet.prototype,"insertRule",({target:t,parameters:[o,s]})=>{n(t,t=>e(x(p.StyleSheetRule,{id:t,adds:[{rule:o,index:s}]})))}),(0,O.H)(CSSStyleSheet.prototype,"deleteRule",({target:t,parameters:[o]})=>{n(t,t=>e(x(p.StyleSheetRule,{id:t,removes:[{index:o}]})))})];function s(t){o.push((0,O.H)(t.prototype,"insertRule",({target:t,parameters:[o,s]})=>{n(t.parentStyleSheet,n=>{const r=k(t);r&&(r.push(s||0),e(x(p.StyleSheetRule,{id:n,adds:[{rule:o,index:r}]})))})}),(0,O.H)(t.prototype,"deleteRule",({target:t,parameters:[o]})=>{n(t.parentStyleSheet,n=>{const s=k(t);s&&(s.push(o),e(x(p.StyleSheetRule,{id:n,removes:[{index:s}]})))})}))}return"undefined"!=typeof CSSGroupingRule?s(CSSGroupingRule):(s(CSSMediaRule),s(CSSSupportsRule)),{stop:()=>{o.forEach(t=>t.stop())}}}function k(t){const e=[];let n=t;for(;n.parentRule;){const t=Array.from(n.parentRule.cssRules).indexOf(n);e.unshift(t),n=n.parentRule}if(!n.parentStyleSheet)return;const o=Array.from(n.parentStyleSheet.cssRules).indexOf(n);return e.unshift(o),e}function P(t,e){return(0,c.l)(t,window,["focus","blur"],()=>{e({data:{has_focus:document.hasFocus()},type:l.Focus,timestamp:(0,S.nx)()})})}function A(t,e,n){const o=t.subscribe(12,t=>{var o,s;t.rawRumEvent.type===h.bb.ACTION&&t.rawRumEvent.action.type===h.X2.CLICK&&(null===(s=null===(o=t.rawRumEvent.action.frustration)||void 0===o?void 0:o.type)||void 0===s?void 0:s.length)&&"events"in t.domainContext&&t.domainContext.events&&t.domainContext.events.length&&e({timestamp:t.rawRumEvent.date,type:l.FrustrationRecord,data:{frustrationTypes:t.rawRumEvent.action.frustration.type,recordIds:t.domainContext.events.map(t=>n.getIdForEvent(t))}})});return{stop:()=>{o.unsubscribe()}}}function V(t,e,n){const o=t.subscribe(5,()=>{e(),n({timestamp:(0,S.nx)(),type:l.ViewEnd})});return{stop:()=>{o.unsubscribe()}}}var $=n(539);function F(t,e){const n=t.tagName,o=t.value;if((0,h.Ie)(t,e)){const e=t.type;if("INPUT"===n&&("button"===e||"submit"===e||"reset"===e))return o;if(!o||"OPTION"===n)return;return h.o}return"OPTION"===n||"SELECT"===n?t.value:"INPUT"===n||"TEXTAREA"===n?o:void 0}const H=/url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm,B=/^[A-Za-z]+:|^\/\//,G=/^["']?data:.*,/i;const J=/[^a-z1-6-_]/;function U(t){const e=t.toLowerCase().trim();return J.test(e)?"div":e}function X(t,e){return`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${t}' height='${e}' style='background-color:silver'%3E%3C/svg%3E`}function W(t){if(void 0!==t&&0!==t.length)return t.map(t=>{const e=t.cssRules||t.rules;return{cssRules:Array.from(e,t=>t.cssText),disabled:t.disabled||void 0,media:t.media.length>0?Array.from(t.media):void 0}})}var Y=n(6978);const q=1e6;function j(t,e,n,o){if(e===h.$m.HIDDEN)return null;const s=t.getAttribute(n),r=t.tagName;if((0,h.ap)(r,n,s,e,o)){if("IMG"===r){const e=t;if(e.naturalWidth>0)return X(e.naturalWidth,e.naturalHeight);const{width:n,height:o}=t.getBoundingClientRect();return n>0||o>0?X(n,o):h.eT}return"SOURCE"===r?h.eT:h.o}return s&&"string"==typeof s?(0,h.ei)(s,q):s}function K(t,e,n){t[e].count+=1,t[e].max=Math.max(t[e].max,n),t[e].sum+=n}function Z(t){if(!t)return null;let e;try{e=t.rules||t.cssRules}catch(t){}return e?(n=Array.from(e,(0,Y.nr)()?Q:tt).join(""),o=t.href,n.replace(H,(t,e,n,s,r,i)=>{const a=n||r||i;if(!o||!a||B.test(a)||G.test(a))return t;const u=e||s||"";return`url(${u}${function(t,e){try{return(0,$.c$)(t,e).href}catch(e){return t}}(a,o)}${u})`})):null;var n,o}function Q(t){if(function(t){return"selectorText"in t}(t)&&t.selectorText.includes(":")){const e=/(\[[\w-]+[^\\])(:[^\]]+\])/g;return t.cssText.replace(e,"$1\\$2")}return tt(t)}function tt(t){return function(t){return"styleSheet"in t}(t)&&Z(t.styleSheet)||t.cssText}function et(t,e,n){const o=function(t,e,n){switch(t.nodeType){case t.DOCUMENT_NODE:return function(t,e,n){return{type:d.Document,childNodes:nt(t,e,n),adoptedStyleSheets:W(t.adoptedStyleSheets)}}(t,e,n);case t.DOCUMENT_FRAGMENT_NODE:return function(t,e,n){const o=(0,h.p_)(t);return o&&n.serializationContext.shadowRootsController.addShadowRoot(t),{type:d.DocumentFragment,childNodes:nt(t,e,n),isShadowRoot:o,adoptedStyleSheets:o?W(t.adoptedStyleSheets):void 0}}(t,e,n);case t.DOCUMENT_TYPE_NODE:return o=t,{type:d.DocumentType,name:o.name,publicId:o.publicId,systemId:o.systemId};case t.ELEMENT_NODE:return function(t,e,n){const o=U(t.tagName),s="svg"===(i=t).tagName||i instanceof SVGElement||void 0,r=(0,h.jR)((0,h.dT)(t),e);var i;if(r===h.$m.HIDDEN){const{width:e,height:n}=t.getBoundingClientRect();return{type:d.Element,tagName:o,attributes:{rr_width:`${e}px`,rr_height:`${n}px`,[h.NT]:h.Wd},childNodes:[],isSVG:s}}if(r===h.$m.IGNORE)return;const a=function(t,e,n){if(e===h.$m.HIDDEN)return{};const o={},s=U(t.tagName),r=t.ownerDocument;for(let s=0;s<t.attributes.length;s+=1){const r=t.attributes.item(s).name,i=j(t,e,r,n.configuration);null!==i&&(o[r]=i)}if(t.value&&("textarea"===s||"select"===s||"option"===s||"input"===s)){const n=F(t,e);void 0!==n&&(o.value=n)}if("option"===s&&e===h.$m.ALLOW){const e=t;e.selected&&(o.selected=e.selected)}if("link"===s){const e=Array.from(r.styleSheets).find(e=>e.href===t.href),s=Z(e);s&&e&&(K(n.serializationContext.serializationStats,"cssText",s.length),o._cssText=s)}if("style"===s&&t.sheet){const e=Z(t.sheet);e&&(K(n.serializationContext.serializationStats,"cssText",e.length),o._cssText=e)}const i=t;if("input"!==s||"radio"!==i.type&&"checkbox"!==i.type||(e===h.$m.ALLOW?o.checked=!!i.checked:(0,h.Ie)(i,e)&&delete o.checked),"audio"===s||"video"===s){const e=t;o.rr_mediaState=e.paused?"paused":"played"}let a,u;const c=n.serializationContext;switch(c.status){case 0:a=Math.round(t.scrollTop),u=Math.round(t.scrollLeft),(a||u)&&c.elementsScrollPositions.set(t,{scrollTop:a,scrollLeft:u});break;case 1:c.elementsScrollPositions.has(t)&&({scrollTop:a,scrollLeft:u}=c.elementsScrollPositions.get(t))}return u&&(o.rr_scrollLeft=u),a&&(o.rr_scrollTop=a),o}(t,r,n);let u=[];return(0,h.wR)(t)&&"style"!==o&&(u=nt(t,r,n)),{type:d.Element,tagName:o,attributes:a,childNodes:u,isSVG:s}}(t,e,n);case t.TEXT_NODE:return function(t,e){const n=(0,h.rf)(t,e);if(void 0!==n)return{type:d.Text,textContent:n}}(t,e);case t.CDATA_SECTION_NODE:return{type:d.CDATA,textContent:""}}var o}(t,e,n);if(!o)return null;const s=n.scope.nodeIds.assign(t),r=o;return r.id=s,n.serializedNodeIds&&n.serializedNodeIds.add(s),r}function nt(t,e,n){const o=[];return(0,h.wI)(t,t=>{const s=et(t,e,n);s&&o.push(s)}),o}function ot(t,e,n,o){const s=(0,S.nx)(),r=et(t,e.defaultPrivacyLevel,{serializationContext:o,configuration:e,scope:n});return K(o.serializationStats,"serializationDuration",(0,S.vk)(s,(0,S.nx)())),r}function st(t,e,n,o=document){const s=t.defaultPrivacyLevel,r=new WeakMap,a=o!==document,{stop:u}=(0,c.l)(t,o,a?["change"]:["input","change"],t=>{const e=v(t);(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&d(e)},{capture:!0,passive:!0});let l;if(a)l=i.l;else{const t=[(0,O.t)(HTMLInputElement.prototype,"value",d),(0,O.t)(HTMLInputElement.prototype,"checked",d),(0,O.t)(HTMLSelectElement.prototype,"value",d),(0,O.t)(HTMLTextAreaElement.prototype,"value",d),(0,O.t)(HTMLSelectElement.prototype,"selectedIndex",d)];l=()=>{t.forEach(t=>t.stop())}}return{stop:()=>{l(),u()}};function d(t){const n=(0,h.PJ)(t,s);if(n===h.$m.HIDDEN)return;const o=t.type;let r;if("radio"===o||"checkbox"===o){if((0,h.Ie)(t,n))return;r={isChecked:t.checked}}else{const e=F(t,n);if(void 0===e)return;r={text:e}}f(t,r,e);const i=t.name;"radio"===o&&i&&t.checked&&document.querySelectorAll(`input[type="radio"][name="${CSS.escape(i)}"]`).forEach(n=>{n!==t&&f(n,{isChecked:!1},e)})}function f(t,e,o){const s=o.nodeIds.get(t);if(void 0===s)return;const i=r.get(t);i&&i.text===e.text&&i.isChecked===e.isChecked||(r.set(t,e),n(x(p.Input,{id:s,...e})))}}var rt=n(5629),it=n(5611);const at=100,ut=16;function ct(t,e,n,o,s,r){const a=(0,h.W3)();if(!a)return{stop:i.l,flush:i.l};const u=function(){let r=i.l,a=[];function u(){r(),function(t,e,n,o,s,r){const i=new Map;t.filter(t=>"childList"===t.type).forEach(t=>{t.removedNodes.forEach(t=>{lt(t,r.removeShadowRoot)})});const a=t.filter(t=>t.target.isConnected&&s.nodeIds.areAssignedForNodeAndAncestors(t.target)&&(0,h.PJ)(t.target,o.defaultPrivacyLevel,i)!==h.$m.HIDDEN),u={cssText:{count:0,max:0,sum:0},serializationDuration:{count:0,max:0,sum:0}},{adds:c,removes:l,hasBeenSerialized:d}=function(t,e,n,o,s,r){const i=new Set,a=new Map;for(const e of t)e.addedNodes.forEach(t=>{i.add(t)}),e.removedNodes.forEach(t=>{i.has(t)||a.set(t,e.target),i.delete(t)});const u=Array.from(i);u.sort((t,e)=>{const n=t.compareDocumentPosition(e);return n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_CONTAINS||n&Node.DOCUMENT_POSITION_FOLLOWING?1:n&Node.DOCUMENT_POSITION_PRECEDING?-1:0});const c=new Set,l={status:2,serializationStats:o,shadowRootsController:s},d=[];for(const t of u){if(f(t))continue;const s=(0,h.PJ)(t.parentNode,e.defaultPrivacyLevel,r);if(s===h.$m.HIDDEN||s===h.$m.IGNORE)continue;const i=(0,S.nx)(),a=et(t,s,{serializedNodeIds:c,serializationContext:l,configuration:e,scope:n});if(K(o,"serializationDuration",(0,S.vk)(i,(0,S.nx)())),!a)continue;const u=(0,h.$4)(t);d.push({nextId:m(t),parentId:n.nodeIds.get(u),node:a})}const p=[];return a.forEach((t,e)=>{const o=n.nodeIds.get(t),s=n.nodeIds.get(e);void 0!==o&&void 0!==s&&p.push({parentId:o,id:s})}),{adds:d,removes:p,hasBeenSerialized:f};function f(t){const e=n.nodeIds.get(t);return void 0!==e&&c.has(e)}function m(t){let e=t.nextSibling;for(;e;){const t=n.nodeIds.get(e);if(void 0!==t)return t;e=e.nextSibling}return null}}(a.filter(t=>"childList"===t.type),o,s,u,r,i),f=function(t,e,n,o){var s;const r=[],i=new Set,a=t.filter(t=>!i.has(t.target)&&(i.add(t.target),!0));for(const t of a){if(t.target.textContent===t.oldValue)continue;const i=n.nodeIds.get(t.target);if(void 0===i)continue;const a=(0,h.PJ)((0,h.$4)(t.target),e.defaultPrivacyLevel,o);a!==h.$m.HIDDEN&&a!==h.$m.IGNORE&&r.push({id:i,value:null!==(s=(0,h.rf)(t.target,a))&&void 0!==s?s:null})}return r}(a.filter(t=>"characterData"===t.type&&!d(t.target)),o,s,i),m=function(t,e,n,o){const s=[],r=new Map,i=t.filter(t=>{const e=r.get(t.target);return!(e&&e.has(t.attributeName)||(e?e.add(t.attributeName):r.set(t.target,new Set([t.attributeName])),0))}),a=new Map;for(const t of i){if(t.target.getAttribute(t.attributeName)===t.oldValue)continue;const r=n.nodeIds.get(t.target);if(void 0===r)continue;const i=(0,h.PJ)(t.target,e.defaultPrivacyLevel,o),u=j(t.target,i,t.attributeName,e);let c;if("value"===t.attributeName){const e=F(t.target,i);if(void 0===e)continue;c=e}else c="string"==typeof u?u:null;let l=a.get(t.target);l||(l={id:r,attributes:{}},s.push(l),a.set(t.target,l)),l.attributes[t.attributeName]=c}return s}(a.filter(t=>"attributes"===t.type&&!d(t.target)),o,s,i);(f.length||m.length||l.length||c.length)&&(e(x(p.Mutation,{adds:c,removes:l,texts:f,attributes:m})),n(u))}(a.concat(c.takeRecords()),t,e,n,o,s),a=[]}const{throttled:l,cancel:d}=(0,i.n)(u,ut,{leading:!1});return{addMutations:t=>{0===a.length&&(r=(0,it.BB)(l,{timeout:at})),a.push(...t)},flush:u,stop:()=>{r(),d()}}}(),c=new a((0,rt.dm)(u.addMutations));return c.observe(r,{attributeOldValue:!0,attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),{stop:()=>{c.disconnect(),u.stop()},flush:()=>{u.flush()}}}function lt(t,e){(0,h.XS)(t)&&e(t.shadowRoot),(0,h.wI)(t,t=>lt(t,e))}const dt=(t,e,n,o,s)=>{const r=new Map,i={addShadowRoot:a=>{if(r.has(a))return;const u=ct(n,o,t,e,i,a),c=st(t,e,n,a),l=R(t,e,n,s,a);r.set(a,{flush:()=>u.flush(),stop:()=>{u.stop(),c.stop(),l.stop()}})},removeShadowRoot:t=>{const e=r.get(t);e&&(e.stop(),r.delete(t))},stop:()=>{r.forEach(({stop:t})=>t())},flush:()=>{r.forEach(({flush:t})=>t())}};return i};var pt=n(2689),ft=n(6246);function mt({context:t,creationReason:e,encoder:n}){let o=0;const s=t.view.id,r={start:1/0,end:-1/0,creation_reason:e,records_count:0,has_full_snapshot:!1,index_in_view:u.K_(s),source:"browser",...t},i={cssText:{count:0,max:0,sum:0},serializationDuration:{count:0,max:0,sum:0}};return u.H5(s),{addRecord:function(t,e){r.start=Math.min(r.start,t.timestamp),r.end=Math.max(r.end,t.timestamp),r.records_count+=1,r.has_full_snapshot||(r.has_full_snapshot=t.type===l.FullSnapshot);const s=n.isEmpty?'{"records":[':",";n.write(s+JSON.stringify(t),t=>{o+=t,e(o)})},addStats:function(t){!function(t,e){for(const n of["cssText","serializationDuration"])t[n].count+=e[n].count,t[n].max=Math.max(t[n].max,e[n].max),t[n].sum+=e[n].sum}(i,t)},flush:function(t){if(n.isEmpty)throw new Error("Empty segment flushed");n.write(`],${JSON.stringify(r).slice(1)}\n`),n.finish(e=>{u.L7(r.view.id,e.rawBytesCount),t(r,i,e)})}}}const ht=5*S.OY;let gt=6e4;function vt(t,e,n,o,s,r){return function(t,s,r,i){let a={status:0,nextSegmentCreationReason:"init"};const{unsubscribe:u}=t.subscribe(2,()=>{l("view_change")}),{unsubscribe:c}=t.subscribe(11,t=>{l(t.reason)});function l(t){1===a.status&&(a.segment.flush((e,n,o)=>{const s=function(t,e,n,o){const s=new FormData;s.append("segment",new Blob([t],{type:"application/octet-stream"}),`${e.session.id}-${e.start}`);const r={raw_segment_size:o,compressed_segment_size:t.byteLength,...e},i=JSON.stringify(r);return s.append("event",new Blob([i],{type:"application/json"})),{data:s,bytesCount:t.byteLength,cssText:n.cssText,isFullSnapshot:0===e.index_in_view,rawSize:o,recordCount:e.records_count,serializationDuration:n.serializationDuration}}(o.output,e,n,o.rawBytesCount);(0,pt.Kp)(t)?r.sendOnExit(s):r.send(s)}),(0,ft.DJ)(a.expirationTimeoutId)),a="stop"!==t?{status:0,nextSegmentCreationReason:t}:{status:2}}return{addRecord:t=>{if(2!==a.status){if(0===a.status){const t=function(t,e,n){const o=e.findTrackedSession(),s=n.findView();if(o&&s)return{application:{id:t},session:{id:o.id},view:{id:s.id}}}(e.applicationId,n,o);if(!t)return;a={status:1,segment:mt({encoder:i,context:t,creationReason:a.nextSegmentCreationReason}),expirationTimeoutId:(0,ft.wg)(()=>{l("segment_duration_limit")},ht)}}a.segment.addRecord(t,t=>{t>gt&&l("segment_bytes_limit")})}},addStats:t=>{1===a.status&&a.segment.addStats(t)},stop:()=>{l("stop"),u(),c()}}}(t,0,s,r)}function yt(t,e,n,c,d,p,f){const m=[],g=f||(0,s.sA)([e.sessionReplayEndpointBuilder],e=>{t.notify(14,{error:e}),(0,o.A2)("Error reported to customer",{"error.message":e.message})},gt);let v,y;if((0,r.d0)())({addRecord:v}=function(t){const e=(0,r.Y9)();return{addRecord:n=>{const o=t.findView();e.send("record",n,o.id)}}}(c)),y=i.l;else{const s=vt(t,e,n,c,g,d);v=s.addRecord,y=s.addStats,m.push(s.stop);const r=function(t,e){if(!t.metricsEnabled)return{stop:i.l};const{unsubscribe:n}=e.subscribe(t=>{if("failure"===t.type||"queue-full"===t.type||"success"===t.type&&t.payload.isFullSnapshot){const r=(e=t.type,n=t.bandwidth,{cssText:{count:(s=t.payload).cssText.count,max:s.cssText.max,sum:s.cssText.sum},isFullSnapshot:s.isFullSnapshot,ongoingRequests:{count:n.ongoingRequestCount,totalSize:n.ongoingByteCount},recordCount:s.recordCount,result:e,serializationDuration:{count:s.serializationDuration.count,max:s.serializationDuration.max,sum:s.serializationDuration.sum},size:{compressed:s.bytesCount,raw:s.rawSize}});(0,o.Gk)("Segment network request metrics",{metrics:r})}var e,n,s});return{stop:n}}(p,g.observable);m.push(r.stop)}const{stop:x}=function(t){const{emitRecord:e,emitStats:n,configuration:o,lifeCycle:s}=t;if(!e||!n)throw new Error("emit functions are required");const r=n=>{e(n),(0,a.b)("record",{record:n});const o=t.viewHistory.findView();u.$1(o.id)},i=function(){const t=new WeakMap;return{set(e,n){(e!==document||document.scrollingElement)&&t.set(e===document?document.scrollingElement:e,n)},get:e=>t.get(e),has:e=>t.has(e)}}(),c={nodeIds:function(){const t=new WeakMap;let e=1;const n=e=>t.get(e);return{assign:o=>{let s=n(o);return void 0===s&&(s=e++,t.set(o,s)),s},get:n,areAssignedForNodeAndAncestors:t=>{let e=t;for(;e;){if(void 0===n(e)&&!(0,h.p_)(e))return!1;e=(0,h.$4)(e)}return!0}}}()},d=dt(o,c,r,n,i),{stop:p}=function(t,e,n,o,s,r,i,a){const u=(n,r)=>{const{width:u,height:c}=(0,h.pB)();i({data:{height:c,href:window.location.href,width:u},type:l.Meta,timestamp:n}),i({data:{has_focus:document.hasFocus()},type:l.Focus,timestamp:n});const d={cssText:{count:0,max:0,sum:0},serializationDuration:{count:0,max:0,sum:0}};i({data:{node:ot(document,o,s,{status:r,elementsScrollPositions:t,serializationStats:d,shadowRootsController:e}),initialOffset:{left:(0,h.Gn)(),top:(0,h.zL)()}},type:l.FullSnapshot,timestamp:n}),a(d),window.visualViewport&&i({data:w(window.visualViewport),type:l.VisualViewport,timestamp:n})};u((0,S.nx)(),0);const{unsubscribe:c}=n.subscribe(2,t=>{r(),u(t.startClocks.timeStamp,1)});return{stop:c}}(i,d,s,o,c,f,r,n);function f(){d.flush(),g.flush()}const m=function(){const t=new WeakMap;let e=1;return{getIdForEvent:n=>(t.has(n)||t.set(n,e++),t.get(n))}}(),g=ct(r,n,o,c,d,document),v=[g,b(o,c,r),N(o,c,r,m),R(o,c,r,i,document),M(o,r),st(o,c,r),L(o,c,r),z(c,r),P(o,r),_(o,r),A(s,r,m),V(s,f,r)];return{stop:()=>{d.stop(),v.forEach(t=>t.stop()),p()},flushMutations:f,shadowRootsController:d}}({emitRecord:v,emitStats:y,configuration:e,lifeCycle:t,viewHistory:c});return m.push(x),{stop:()=>{m.forEach(t=>t())}}}}}]);